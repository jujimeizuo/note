---
counter: True
comment: True
---


# 软件构件与体系结构

!!! abstract
    这里记录学习这本书时的笔记（同时是研一的学位课）
    
    作者是我的导师王映辉教授

## 软件复用

### 软件复用的概念

!!! note ""
    软件复用是指在两次或多次不同的软件开发过程中重复使用相同的或相近的软件元素的过程。引出了**构件**的概念。

软件复用可划分为如下几类：

1. 代码的复用
2. 设计的复用
3. 分析的复用
4. 测试信息的复用

### 软件复用的实现

#### 基本问题

1. 工程方面
    - 缺少能够清晰标识可复用模型要素的手段。
    - 缺少能够复用的构件。
    - 可复用的构件缺乏灵活性。
    - 缺乏执行复用过程的工具。
2. 过程方面
3. 组织方面
4. 资金方面

#### 关键因素

**复用依赖于软件体系结构**。使用软件体系结构来规划和管理大规模可复用系统的复杂性是最好的解决方法。

### 软件复用与构件技术

!!! note ""
    构件是具有一定功能、能够独立工作或同其他构件装配起来协调工作的程序体，构件的使用同它的开发、生产无关。整个构件隐藏了具体的实现，只用接口对外提供服务。

- 从外部形态看：
    1. 独立而成熟的构件
    2. 有限制的构件
    3. 适用性构件
    4. 装配的构件
    5. 可修改的构件

## 构件技术

### 软件开发中的问题

- 技术与需求变化的问题。
- 重复不必要的工作问题。
- 应用集成的问题。
- 软件难以维护的问题。
- 软件质量和成本有效性问题等。

构件技术是目前支持软件复用的核心技术。研究内容包括：

1. 构件获取：有目的的构件生产和从已有系统中挖掘提取构件。
2. 研究模型：研究构件的本质特征和构件间的关系。
3. 构件描述语言：以构件模型为基础，解决构件的精确描述、理解、检素及组装问题。
4. 构件分类与检索：研究构件分类策略、组织模式及检素策略，建立构件库系统，支持构件的有效管理。
5. 构件复合组装：在构件模型的基础上研究构件组装机制，包括源代码级的组装和基于构件对象互操作性的组装。
6. 标准化：构件模型的标准化和构件库系统的标准化等。


### 软件构件的概念

!!! note ""
    软件成分包括程序代码、测试用例、设计文档、设计过程、需求分析文档，甚至领域知识，通常把这种可复用的软件成分称为软件构件，简称软构件或者构件。可复用的软件元素越大，我们就说复用的粒度(Granularity)越大。

1. 构件是预先构建的。
2. 构件是黑盒的。
3. 构件是可分离的。
4. 构件能用于组装和部署。
5. 构件需要称为构件容器技术的支持。

一个完整的构件应包含6个要素：

1. 受约束的构件标准：符合某种构件模型。
2. 规格说明：构件提供服务的抽象描述，用作服务的客户方和提供方之间的契约。
3. 实现：必须符合规格说明，各自实现。
4. 包装方法：按不同的方式分组来提供 一套可以替换的服务(包)。
5. 注册：可在构件支持环境中注册。
6. 部署方法：构件可以部署多个实例。


### 软件构件的规格说明

1. 构件的名称与简短描述。
2. 构件服务。
3. 构件接口信息。
4. 所需的接口。
5. 发布和接受的事件。
6. 构件特征。
7. 附加信息。

### 软件构件接口

!!! note ""
    构件必领对其所提供的服务进行抽象描述，以作为服务的容户方和提供方之间的契约，这就是构件接口。


### 软件构件模型

#### 构件模型的概念

!!! note ""
    构件模型定义了什么是构件、构件的依据、如何使用其他构件提供的服务等。將构件的规格说明和具体实现分离，依靠构件实现的具体模式来推导出构件所提供的服务，可以构造一个构件模型。

使用中间件，也可以使构件之间进行更好地通信。如构件之间直接进行通信，当构成系统的构件数量庞大时，其复杂程度迅速提高；如能引人中介层 (中间件)，则可很好地避免构件间复杂的交互。如下图所示：

<center>![中间件](https://cdn.jujimeizuo.cn/note/cs/software/sca/middleware.jpg)</center>

#### 青鸟软件构件模型

青鸟软件构件模型国内许多学者在构件模型的研究方面做了不少的工作，其中较为突出的是北京大学杨芙清院士等人提出的“青鸟软件构件模型(JBCOM)”。它由外部接又与内部结构两部分组成。如下图所示：


<center>![青鸟软件构件模型](https://cdn.jujimeizuo.cn/note/cs/software/sca/Bluebird-model.jpg)</center>

构件的外部接口是指构件向其复用者提供的基本信息，包括:构件名称、功能描述、对外功能接口，所需服务的构件和参数化属性等。外部接口是构件与外界的一组交互点，说明了构件所提供的那些服务(消息、操作和变量)。

构件的内部结构包括两方面的内容:内部成员以及内部成员之间的关系。其中，内部成员包括具体成员与虚拟成员，而成员关系包括成员之间的互联，以及内部成员与外部接口之间的互联。

#### 构件模型的描述方法

```
构件::=〈构件规约，构件实现〉
构件规约::=〈接又部分，结构部分〉
接口部分::=〈对外提供的功能集合，对外请求的功能集合，服务集合〉
服务::=〈对外提供的功能集合，对外请求的功能集合〉
结构部分::=〈原子构件结构〉|〈复合构件结构〉
原子构件结构::=〈构件实现的引用〉
复合构件结构::=〈引用的构件类型，实例声明，实例连接，映射〉
```

eg. 编译器复合构件实例。


### 软件构件的深层理解

- 构件的粒度
- 构件的基础设施
- 构件的获取
- 构件的管理
- 组装与部署

## 面向构件

### 面向构件的概念

通过分析、设计和实现，来得到所需的构件


### 构件的分类

- 根据软件 3 层框架的构件分类
    - 表示层
    - 业务层
    - 数据层
    
    据此框架，构件可以被分为 3 类：应用软件、业务构件和数据构件
    ??? note "业务构件的获取情况"
        1. 定义业务对象
        2. 确定控制逻辑（业务过程）
        3. 确定业务对象与控制逻辑之间的交互
        4. 区分公司的业务逻辑和特定部门的业务逻辑
        5. 将业务对象和控制逻辑分配到相应的业务构件中去
    - 基于构件粒度大小的构件分类
        
        可分为：大粒度的应用构件、用户任务构件、批处理构件和子任务构件


### 构件的设计与实现

#### 构件接口定义的原则

构件接口的定义的基本原则：

1. 定义一些不变的接口
2. 定义自描述的接口
3. 定义元数据性质的接口
4. 构件设计成可定制的

#### 原子构件的制作

原子构件 Atom 是最小粒度的构件，该构件在功能等方面具有不可再拆分的性质。

- 当一个原子构件的实体对应单个对象时，可以称这个构件是单对象构件，制作流程如下：
    - 定义接口规约。
    - 制作构件实体。
- 当一个原子构件对应多个协作对象时，制作流程如下：
    - 需要引入一个控制对象。
    - 定义构件接口的规约部分。
    - 制作构件实体。

#### 复合构件的制作

复合构件 Assemble 是由原子构件或者复合构件组装而成的。

制作流程如下：

- 定义构件的接口规约部分
- 确定所包含的成员构件
- 建立内部的成员构件之间的接口连接关系
- 将复合构件对外提供和要求的功能映射到内部成员构件相应的功能上

在建立内部成员之间的连接关系以及复合构件和成员构件的功能映射时，遵循一下规则：

- 成员构件对外要求的功能只能由一个提供者提供
- 成员构件对外提供的功能可以有多个使用者
- 复合构件对外要求的功能可以映射到多个成员构件的功能上
- 复合构件对外提供的功能只能映射到一个成员构件的功能上


### 构件的管理与维护

构件库是对构件实施分类和管理的机构。


#### 构件库的组织

构件库理论研究的重点是构件分类与检索，即研究构件分类策略、组织模式、检索手段和构件相似性分析等。

<center>![构件库的组织关系图](https://cdn.jujimeizuo.cn/note/cs/software/sca/organization-diagram.jpg)</center>

领域上构件库满足的条件：

- 领域完整性
- 领域抽象性
- 领域标准化

#### 构件库的分类模式

- 关键字分类法
- 超文本组织法
- **刻面分类法**
    
    由一组描述构件本质特征的刻面组成，每个刻面从不同的角度对构件进行分类。
    
    从表示的角度来看，刻面是一颗有向树，根节点的值是该刻面的名称，根节点所有子树构成的森林称为术语空间

    特点：
        
    - 对构件进行了多视角下的分类描述
    - 构件分类描述的术语空间易于修改和维护

## 基于构件

### 构件组装

构件组装就是确定构件所提供的服务与接口之间的匹配和映射，并提供满足即将或将来部署的约束条件。

#### 构件组装中的问题

任何基于构件的开发应符合以下构件：

1. 要清晰地分离构件的规格说明和设计实现
2. 重点关注于接口的实现方法
3. 形式地描述构件的语义，主要是对构件行为的描述，其核心是操作特征的语义细节
4. 严格地记录细化过程，并且加以验证

从技术角度看，构件组装过程中需考虑的问题：

1. 每个构件满足其他构件的限制条件问题
2. 构件组装中的接口匹配和映射问题
3. 构件的包装问题

#### 构件组装的方法与技术

1. 定制
    1. 设置参数值
    2. 完成需要用户定制的代码
    3. 有时候需要重新编译构件
2. 包装
3. 适配

??? note "适配器"
    - 适配器位于两个构件之间，用以转换两个构件对接口的不同理解，是请求者和被请求者之间的映射
    - 适配器本身不包含表示层、业务层和数据访问层的逻辑，也不能扩展构件的功能（与包装不同）
    - 适配器不是构件，不属于被适配的两个构件的任何一个，任何一个构件的不存在将导致适配器的消失
    - 验证和错误处理功能
    - 安全性

#### 构件组装的内容

构件组装的实施内容：

1. 强制实现构件的限制条件
2. 处理功能和数据的不匹配
3. 管理构件间的关系


构件之间的关系类型包括拥有关系和外部关系。但从关系的表示角度来看，可分为直接链接和间接链接。


<center>![构件之间的关系类型与表示](https://cdn.jujimeizuo.cn/note/cs/software/sca/goujian-relationship.jpg)</center>

