<!DOCTYPE html>
<html class="no-js" lang="zh">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="狙击美佐（jujimeizuo）的笔记本" name="description"/>
<link href="https://note.jujimeizuo.cn/llm/internlm/lec4/" rel="canonical"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.5.3, mkdocs-material-8.1.4" name="generator"/>
<title>第四节 - 狙击美佐的笔记本</title>
<link href="../../../assets/stylesheets/main.bb3983ee.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.e6a45f82.min.css" rel="stylesheet"/>
<link href="../../../css/heti.css" rel="stylesheet"/>
<link href="../../../css/toc_extra.css" rel="stylesheet"/>
<link href="../../../css/timeline.css" rel="stylesheet"/>
<link href="https://cdn.jujimeizuo.cn/utils/katex.min.css" rel="stylesheet"/>
<link href="https://cdn.jujimeizuo.cn/jbmono/jetbrainsmono.css" rel="stylesheet"/>
<link href="https://cdn.jujimeizuo.cn/lxgw/lxgwscreen.css" rel="stylesheet"/>
<link href="../../../css/tasklist.css" rel="stylesheet"/>
<link href="../../../css/custom.css" rel="stylesheet"/>
<link href="../../../css/card.css" rel="stylesheet"/>
<link href="../../../css/flink.css" rel="stylesheet"/>
<link href="../../../css/changelog_extra.css" rel="stylesheet"/>
<link href="/css/counter.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?c132cf94e416183874b5b1aa8df85c52";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-CY82KV89G2"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-CY82KV89G2",{page_path:e.pathname})})})</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-CY82KV89G2"></script>
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            
                .gscrollbar-fixer { padding-right: 15px; }
                .gdesc-inner { font-size: 0.75rem; }
                body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
                body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
                body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
                </style><script src="../../../assets/javascripts/glightbox.min.js"></script></head>
<body data-md-color-accent="" data-md-color-primary="" data-md-color-scheme="default" dir="ltr">
<script src="../../../js/scheme.js" type="text/javascript"></script>
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#xtuner">
            跳转至
          </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="页眉" class="md-header__inner md-grid">
<a aria-label="狙击美佐的笔记本" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="狙击美佐的笔记本">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4h-2M3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7H3m2-2v2h2V5H5m0 14h2v-2H5v2m0-6h2v-2H5v2z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            狙击美佐的笔记本
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              第四节
            
          </span>
</div>
</div>
</div>
<div class="md-header__options">
<div class="md-header-nav__scheme md-header-nav__button md-source__icon md-icon">
<a class="light-mode" href="javascript:toggleScheme();" title="Light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22z"></path></svg>
</a>
<a class="dark-mode" href="javascript:toggleScheme();" title="Dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31z"></path></svg>
</a>
<a class="system-mode" href="javascript:toggleScheme();" title="System preference">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 2c-1.79 1.15-3 3.18-3 5.5s1.21 4.35 3.03 5.5C4.46 13 2 10.54 2 7.5A5.5 5.5 0 0 1 7.5 2m11.57 1.5 1.43 1.43L4.93 20.5 3.5 19.07 19.07 3.5m-6.18 2.43L11.41 5 9.97 6l.42-1.7L9 3.24l1.75-.12.58-1.65L12 3.1l1.73.03-1.35 1.13.51 1.67m-3.3 3.61-1.16-.73-1.12.78.34-1.32-1.09-.83 1.36-.09.45-1.29.51 1.27 1.36.03-1.05.87.4 1.31M19 13.5a5.5 5.5 0 0 1-5.5 5.5c-1.22 0-2.35-.4-3.26-1.07l7.69-7.69c.67.91 1.07 2.04 1.07 3.26m-4.4 6.58 2.77-1.15-.24 3.35-2.53-2.2m4.33-2.7 1.15-2.77 2.2 2.54-3.35.23m1.15-4.96-1.14-2.78 3.34.24-2.2 2.54M9.63 18.93l2.77 1.15-2.53 2.19-.24-3.34z"></path></svg>
</a>
<a class="unknown-mode" href="javascript:toggleScheme();" title="Unknown scheme">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m15.07 11.25-.9.92C13.45 12.89 13 13.5 13 15h-2v-.5c0-1.11.45-2.11 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41a2 2 0 0 0-2-2 2 2 0 0 0-2 2H8a4 4 0 0 1 4-4 4 4 0 0 1 4 4 3.2 3.2 0 0 1-.93 2.25M13 19h-2v-2h2M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10c0-5.53-4.5-10-10-10z"></path></svg>
</a>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="搜索" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="搜索" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="查找" class="md-search__options">
<button aria-label="清空当前内容" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            正在初始化搜索引擎
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/jujimeizuo/note/" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    jujimeizuo/note
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="标签" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
        Home
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../cs/">
        Computer Science
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../cv/">
        3DV
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../../">
        LLM
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../mb/">
        Math Basis
      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../utils/">
        Utils
      </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="导航栏" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="狙击美佐的笔记本" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="狙击美佐的笔记本">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 4v6l-2-2-2 2V4H9v16h10V4h-2M3 7V5h2V4a2 2 0 0 1 2-2h12c1.05 0 2 .95 2 2v16c0 1.05-.95 2-2 2H7c-1.05 0-2-.95-2-2v-1H3v-2h2v-4H3v-2h2V7H3m2-2v2h2V5H5m0 14h2v-2H5v2m0-6h2v-2H5v2z"></path></svg>
</a>
    狙击美佐的笔记本
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/jujimeizuo/note/" title="前往仓库">
<div class="md-source__icon md-icon">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"></path></svg>
</div>
<div class="md-source__repository">
    jujimeizuo/note
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" id="__nav_1" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../..">Home</a>
<label for="__nav_1">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Home" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_1">
<span class="md-nav__icon md-icon"></span>
          Home
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../changelog/">
        更新记录
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../links/">
        友链
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cs/">Computer Science</a>
<label for="__nav_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Computer Science" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Computer Science
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" id="__nav_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cs/pl/">编程语言</a>
<label for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="编程语言" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
          编程语言
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_2" id="__nav_2_2_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cs/pl/c_cpp/">C/C++</a>
<label for="__nav_2_2_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="C/C++" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_2">
<span class="md-nav__icon md-icon"></span>
          C/C++
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/pl/c_cpp/basic/">
        C++ 系统知识
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/pl/c_cpp/stl/">
        C++ STL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/pl/c_cpp/function/">
        C++ 各种函数使用
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_3" id="__nav_2_2_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cs/pl/python/">Python</a>
<label for="__nav_2_2_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Python" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_3">
<span class="md-nav__icon md-icon"></span>
          Python
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/pl/python/basic/">
        Python 语法基础
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/pl/python/numpy/">
        Numpy 科学计算库
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/pl/python/virtual/">
        Python 虚拟环境
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_4" id="__nav_2_2_4" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cs/pl/go/">Go</a>
<label for="__nav_2_2_4">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Go" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_4">
<span class="md-nav__icon md-icon"></span>
          Go
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/pl/go/basic/">
        Go 语法基础
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/pl/go/gin/">
        gin框架 (TODO)
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2_5" id="__nav_2_2_5" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cs/pl/java/">Java</a>
<label for="__nav_2_2_5">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Java" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_2_5">
<span class="md-nav__icon md-icon"></span>
          Java
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/pl/java/basic/">
        Java 系统知识
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/pl/java/springboot/">
        SpringBoot
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3">
          算法相关
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="算法相关" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
          算法相关
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/algorithm/basic-ds/">
        基础数据结构
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/algorithm/design-analysis/">
        算法设计与分析
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4">
          人工智能基础
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="人工智能基础" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
          人工智能基础
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/ai/mode-recognition/">
        模式识别
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/ai/ml/">
        机器学习
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/ai/dl/">
        神经网络与深度学习
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" id="__nav_2_5" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cs/hpc/">高性能计算</a>
<label for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="高性能计算" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
          高性能计算
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/hpc/outline/">
        概论
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/hpc/vectorizecompute/">
        向量化计算
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/hpc/gpu/">
        GPU 编程
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/hpc/mpi/">
        MPI 基础
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/hpc/openmp/">
        OpenMP 基础
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" id="__nav_2_6" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cs/software/">软件相关</a>
<label for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="软件相关" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
          软件相关
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/software/design-pattern/">
        设计模式
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/software/sca/">
        软件构件与体系结构
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/software/compa/">
        COM 原理与应用
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/software/piaserver/">
        应用服务器原理与实现
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" id="__nav_2_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_7">
          数据库相关
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="数据库相关" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_7">
<span class="md-nav__icon md-icon"></span>
          数据库相关
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/db/mysql/">
        MySQL
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7_2" id="__nav_2_7_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_7_2">
          Redis
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="Redis" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_7_2">
<span class="md-nav__icon md-icon"></span>
          Redis
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/db/redis/datatype/">
        数据类型
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/db/redis/cjh/">
        持久化
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/db/redis/work/">
        事务
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_8" id="__nav_2_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_8">
          杂项
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="杂项" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_8">
<span class="md-nav__icon md-icon"></span>
          杂项
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cs/others/regex/">
        RegEx 正则表达式
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" id="__nav_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/">3DV</a>
<label for="__nav_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="3DV" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          3DV
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" id="__nav_3_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/mvg/">多视图几何</a>
<label for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="多视图几何" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_2">
<span class="md-nav__icon md-icon"></span>
          多视图几何
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/mvg/pjt2d/">
        2D 射影几何和变换
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/mvg/pjt3d/">
        3D 射影几何和变换
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/mvg/est2d/">
        估计——2D 射影变换
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/mvg/eval/">
        算法评价和误差分析
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/mvg/camera-model/">
        摄像机模型
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/mvg/calc-p/">
        计算摄像机矩阵 P
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/mvg/one-vg/">
        单视图几何
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/mvg/ag-fm/">
        对极几何和基本矩阵
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/mvg/3dr-camera-structure/">
        摄像机和结构的 3D 重构
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" id="__nav_3_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/pcd/">三维点云</a>
<label for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="三维点云" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_3">
<span class="md-nav__icon md-icon"></span>
          三维点云
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3_2" id="__nav_3_3_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/pcd/pcr/">点云配准</a>
<label for="__nav_3_3_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="点云配准" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_3_2">
<span class="md-nav__icon md-icon"></span>
          点云配准
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/pcd/pcr/prepare/">
        前置知识
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/pcd/pcr/icp/">
        ICP
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" id="__nav_3_4" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/dataset/">数据集相关</a>
<label for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="数据集相关" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_4">
<span class="md-nav__icon md-icon"></span>
          数据集相关
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/dataset/tum/">
        TUM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/dataset/kitti/">
        KITTI
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/dataset/waymo/">
        Waymo
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" id="__nav_3_5" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/papers/">论文相关</a>
<label for="__nav_3_5">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="论文相关" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_5">
<span class="md-nav__icon md-icon"></span>
          论文相关
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_2" id="__nav_3_5_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/papers/pcd/">PointCloud 系列</a>
<label for="__nav_3_5_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="PointCloud 系列" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_5_2">
<span class="md-nav__icon md-icon"></span>
          PointCloud 系列
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/pcd/geotransformer/">
        GeoTransformer
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/pcd/mac/">
        MAC
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/pcd/fastmac/">
        FastMAC
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_3" id="__nav_3_5_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/papers/dynamic-slam/">Dynamic SLAM 系列</a>
<label for="__nav_3_5_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Dynamic SLAM 系列" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_5_3">
<span class="md-nav__icon md-icon"></span>
          Dynamic SLAM 系列
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dynamic-slam/dynaslam/">
        DynaSLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dynamic-slam/ds-slam/">
        DS-SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dynamic-slam/detect-slam/">
        Detect-SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dynamic-slam/flowfusion/">
        FlowFusion
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dynamic-slam/rigidfusion/">
        RigidFusion
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dynamic-slam/crowd-slam/">
        Crowd-SLAM
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_4" id="__nav_3_5_4" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/papers/nerf/">NeRF 系列</a>
<label for="__nav_3_5_4">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="NeRF 系列" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_5_4">
<span class="md-nav__icon md-icon"></span>
          NeRF 系列
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/nerf/nerf/">
        NeRF
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/nerf/nerf-evaluation/">
        NeRF-Evaluation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/nerf/imap/">
        iMAP
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/nerf/co-slam/">
        Co-SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/nerf/nice-slam/">
        NICE-SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/nerf/nid-slam/">
        NID-SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/nerf/ddn-slam/">
        DDN-SLAM
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_5" id="__nav_3_5_5" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/papers/3dgs/">3DGS 系列</a>
<label for="__nav_3_5_5">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="3DGS 系列" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_5_5">
<span class="md-nav__icon md-icon"></span>
          3DGS 系列
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/3dgs/3dgs/">
        3DGS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/3dgs/4dgs/">
        4DGS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/3dgs/splatam/">
        SplaTAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/3dgs/monogs/">
        MonoGS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/3dgs/loop-splat/">
        LoopSplat
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/3dgs/splat-slam/">
        Splat-SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/3dgs/wildgs-slam/">
        WildGS-SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/3dgs/4dtam/">
        4DTAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/3dgs/4dgs-slam/">
        4DGS-SLAM
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_6" id="__nav_3_5_6" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/papers/dust3r/">DUSt3R 系列</a>
<label for="__nav_3_5_6">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="DUSt3R 系列" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_5_6">
<span class="md-nav__icon md-icon"></span>
          DUSt3R 系列
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/dust3r/">
        DUSt3R
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/mast3r/">
        MASt3R
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/spann3r/">
        Spann3R
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/fast3r/">
        Fast3R
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/instant-splat/">
        InstantSplat
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/monst3r/">
        MonST3R
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/das3r/">
        DAS3R
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/cut3r/">
        CUT3R
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/easi3r/">
        Easi3R
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/mast3r-slam/">
        MASt3R-SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/slam3r/">
        SLAM3R
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/vggt/">
        VGGT
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/vggt-slam/">
        VGGT-SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/vggt-long/">
        VGGT-Long
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/anycam/">
        AnyCam
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/dust3r/page-4d/">
        PAGE-4D
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_7" id="__nav_3_5_7" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/papers/endo/">Endo 系列</a>
<label for="__nav_3_5_7">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Endo 系列" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_5_7">
<span class="md-nav__icon md-icon"></span>
          Endo 系列
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/endo/endoscopy-depth-estimation/">
        EndoscopyDepthEstimation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/endo/endo-4dgs/">
        Endo-4DGS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/endo/endogaussian/">
        EndoGaussian
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/endo/endogs/">
        EndoGS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/endo/lgs/">
        LGS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/endo/st-endo4dgs/">
        ST-Endo4DGS
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/endo/endo-4dgx/">
        Endo-4DGX
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/endo/colorgs/">
        ColorGS
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_8" id="__nav_3_5_8" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/papers/others/">杂项</a>
<label for="__nav_3_5_8">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="杂项" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_3_5_8">
<span class="md-nav__icon md-icon"></span>
          杂项
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5_8_2" id="__nav_3_5_8_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/papers/others/vslam14/">视觉 SLAM 十四讲</a>
<label for="__nav_3_5_8_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="视觉 SLAM 十四讲" class="md-nav" data-md-level="4">
<label class="md-nav__title" for="__nav_3_5_8_2">
<span class="md-nav__icon md-icon"></span>
          视觉 SLAM 十四讲
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/others/vslam14/lec1/">
        初识 SLAM
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/others/vslam14/lec2/">
        三维空间刚体运动
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/others/orbslam2/">
        ORB-SLAM2
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/others/let-net/">
        LET-NET
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/papers/others/deepv2d/">
        DeepV2D
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" id="__nav_3_6" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../cv/utils/">工具相关</a>
<label for="__nav_3_6">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="工具相关" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_3_6">
<span class="md-nav__icon md-icon"></span>
          工具相关
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/utils/colmap/">
        COLMAP
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cv/3d-visualization/">
        三维数据场可视化
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../">LLM</a>
<label for="__nav_4">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="LLM" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          LLM
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" id="__nav_4_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../nlp/">NLP</a>
<label for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="NLP" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
          NLP
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../nlp/word2vec/">
        Word2Vec
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../nlp/rnns/">
        RNN
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" id="__nav_4_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../transformer/">Transformer</a>
<label for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Transformer" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
          Transformer
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../transformer/attention/">
        Attention
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../transformer/transformer/">
        Transformer
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../transformer/bert/">
        BERT
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../transformer/vit/">
        ViT
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_4" id="__nav_4_4" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../">书生·浦语大模型实战营</a>
<label for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="书生·浦语大模型实战营" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
          书生·浦语大模型实战营
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../lec1/">
        第一节
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lec2/">
        第二节
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lec3/">
        第三节
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          第四节
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        第四节
      </a>
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
        目录
      </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#finetune">
    Finetune
  </a>
<nav aria-label="Finetune" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
    增量预训练微调
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    指令跟随微调
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lora-qlora">
    LoRA &amp; QLoRA
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner_1">
    Xtuner
  </a>
<nav aria-label="Xtuner" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    快速上手
  </a>
<nav aria-label="快速上手" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
    使用流程
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
    自定义训练
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
    对话
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner_2">
    XTuner 数据引擎
  </a>
<nav aria-label="XTuner 数据引擎" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
    数据处理流程
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pack-dataset">
    多数据样本拼接（Pack Dataset）
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-gb-llm">
    8 GB 显卡玩转 LLM
  </a>
<nav aria-label="8 GB 显卡玩转 LLM" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner_3">
    XTuner 加速方式
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
    实战训练
  </a>
<nav aria-label="实战训练" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
    环境 &amp; 安装
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
    微调
  </a>
<nav aria-label="微调" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
    准备配置文件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
    模型下载
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
    数据集下载
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
    修改配置文件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
    开始微调
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adapter">
    生成 Adapter 文件
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
    部署与测试
  </a>
<nav aria-label="部署与测试" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#huggingface-adapter">
    将 HuggingFace adapter 合并到大语言模型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
    与合并后的模型对话
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
    自定义微调
  </a>
<nav aria-label="自定义微调" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
    概述
  </a>
<nav aria-label="概述" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_20">
    场景需求
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_21">
    真实数据预览
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_22">
    数据准备
  </a>
<nav aria-label="数据准备" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner_4">
    将数据转为 XTuner 的数据格式
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_23">
    划分训练集和测试集
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_24">
    开始自定义微调
  </a>
<nav aria-label="开始自定义微调" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_25">
    准备配置文件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner_5">
    XTuner！启动！
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adapter_1">
    生成 Adapter 文件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_26">
    部署与测试
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ms-agent-llm-agent">
    用 MS-Agent 数据集赋予 LLM 以 Agent 能力
  </a>
<nav aria-label="用 MS-Agent 数据集赋予 LLM 以 Agent 能力" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_27">
    概述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_28">
    微调步骤
  </a>
<nav aria-label="微调步骤" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_29">
    准备工作
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_30">
    开始微调
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_31">
    直接使用
  </a>
<nav aria-label="直接使用" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adapter_2">
    下载 Adapter
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#serper">
    添加 serper 环境变量
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner-agent">
    xtuner + agent，启动！
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner-internlm-chat">
    作业：XTuner InternLM-Chat 个人小助手认知微调实践
  </a>
<nav aria-label="作业：XTuner InternLM-Chat 个人小助手认知微调实践" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_32">
    环境准备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_33">
    数据准备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_34">
    配置准备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_35">
    微调
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_36">
    参数转换/合并
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#demo">
    Demo
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_37">
    效果
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_38">
    进阶作业
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lec5/">
        第五节
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../lec6/">
        第六节
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_5" id="__nav_4_5" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../dw2025winter/">2025 AI 冬令营</a>
<label for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="2025 AI 冬令营" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
          2025 AI 冬令营
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../dw2025winter/lec1/">
        速通AI辅助番茄时钟开发
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_6" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6">
          杂项
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="杂项" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
          杂项
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../others/prompt/">
        Prompt
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../others/dt/">
        分布式训练
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" id="__nav_5" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../mb/">Math Basis</a>
<label for="__nav_5">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Math Basis" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
          Math Basis
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_2" id="__nav_5_2" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../mb/optimization-theory/">最优化理论与方法</a>
<label for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="最优化理论与方法" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_2">
<span class="md-nav__icon md-icon"></span>
          最优化理论与方法
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../mb/optimization-theory/lec1/">
        最优化问题
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../mb/optimization-theory/lec2/">
        直线搜索
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../mb/optimization-theory/lec3/">
        无约束最优化的梯度方法
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_3" id="__nav_5_3" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../mb/maa/">矩阵分析与应用</a>
<label for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="矩阵分析与应用" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_5_3">
<span class="md-nav__icon md-icon"></span>
          矩阵分析与应用
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../mb/maa/lec1/">
        矩阵代数基础
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../mb/maa/lec2/">
        特殊矩阵
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../mb/maa/lec3/">
        矩阵微分
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../mb/comb/">
        组合数学
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" id="__nav_6" type="checkbox"/>
<div class="md-nav__link md-nav__link--index">
<a href="../../../utils/">Utils</a>
<label for="__nav_6">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-label="Utils" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_6">
<span class="md-nav__icon md-icon"></span>
          Utils
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/utilsbox/">
        工具收集
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_3" id="__nav_6_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_3">
          命令行工具
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="命令行工具" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_3">
<span class="md-nav__icon md-icon"></span>
          命令行工具
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/shell/">
        Shell 命令相关
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/git/">
        Git 命令相关
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/docker/">
        Docker 命令相关
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/gdb/">
        gdb 命令相关
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_4" id="__nav_6_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_4">
          CI 工具
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="CI 工具" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_4">
<span class="md-nav__icon md-icon"></span>
          CI 工具
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/action/">
        Github Action
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_5" id="__nav_6_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_5">
          站点生成工具
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="站点生成工具" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_5">
<span class="md-nav__icon md-icon"></span>
          站点生成工具
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/reveal-md/">
        reveal-md
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/gitbook/">
        gitbook
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/mkdocs/">
        mkdocs
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/hexo/">
        hexo
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_6" id="__nav_6_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_6">
          视频图像处理工具
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="视频图像处理工具" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_6">
<span class="md-nav__icon md-icon"></span>
          视频图像处理工具
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/ffmpeg/">
        ffmpeg
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/imagemagick/">
        ImageMagick
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_7" id="__nav_6_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_6_7">
          AI 工具
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-label="AI 工具" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_6_7">
<span class="md-nav__icon md-icon"></span>
          AI 工具
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../utils/wandb/">
        Weights &amp; Biases
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="目录" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
        目录
      </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#finetune">
    Finetune
  </a>
<nav aria-label="Finetune" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_1">
    增量预训练微调
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_2">
    指令跟随微调
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#lora-qlora">
    LoRA &amp; QLoRA
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner_1">
    Xtuner
  </a>
<nav aria-label="Xtuner" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_3">
    快速上手
  </a>
<nav aria-label="快速上手" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_4">
    使用流程
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_5">
    自定义训练
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_6">
    对话
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner_2">
    XTuner 数据引擎
  </a>
<nav aria-label="XTuner 数据引擎" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_7">
    数据处理流程
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#pack-dataset">
    多数据样本拼接（Pack Dataset）
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#8-gb-llm">
    8 GB 显卡玩转 LLM
  </a>
<nav aria-label="8 GB 显卡玩转 LLM" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner_3">
    XTuner 加速方式
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_8">
    实战训练
  </a>
<nav aria-label="实战训练" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_9">
    环境 &amp; 安装
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_10">
    微调
  </a>
<nav aria-label="微调" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_11">
    准备配置文件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_12">
    模型下载
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_13">
    数据集下载
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_14">
    修改配置文件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_15">
    开始微调
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adapter">
    生成 Adapter 文件
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_16">
    部署与测试
  </a>
<nav aria-label="部署与测试" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#huggingface-adapter">
    将 HuggingFace adapter 合并到大语言模型
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_17">
    与合并后的模型对话
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_18">
    自定义微调
  </a>
<nav aria-label="自定义微调" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_19">
    概述
  </a>
<nav aria-label="概述" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_20">
    场景需求
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_21">
    真实数据预览
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_22">
    数据准备
  </a>
<nav aria-label="数据准备" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner_4">
    将数据转为 XTuner 的数据格式
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_23">
    划分训练集和测试集
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_24">
    开始自定义微调
  </a>
<nav aria-label="开始自定义微调" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_25">
    准备配置文件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner_5">
    XTuner！启动！
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#adapter_1">
    生成 Adapter 文件
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_26">
    部署与测试
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#ms-agent-llm-agent">
    用 MS-Agent 数据集赋予 LLM 以 Agent 能力
  </a>
<nav aria-label="用 MS-Agent 数据集赋予 LLM 以 Agent 能力" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_27">
    概述
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_28">
    微调步骤
  </a>
<nav aria-label="微调步骤" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_29">
    准备工作
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_30">
    开始微调
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_31">
    直接使用
  </a>
<nav aria-label="直接使用" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#adapter_2">
    下载 Adapter
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#serper">
    添加 serper 环境变量
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner-agent">
    xtuner + agent，启动！
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#xtuner-internlm-chat">
    作业：XTuner InternLM-Chat 个人小助手认知微调实践
  </a>
<nav aria-label="作业：XTuner InternLM-Chat 个人小助手认知微调实践" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#_32">
    环境准备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_33">
    数据准备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_34">
    配置准备
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_35">
    微调
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_36">
    参数转换/合并
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#demo">
    Demo
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_37">
    效果
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#_38">
    进阶作业
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<script defer="" src="/js/toc.js"></script>
<link href="/css/fold_toc.css" rel="stylesheet"/>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<a class="md-content__button md-icon" href="https://github.com/jujimeizuo/note/tree/master/docs/llm/internlm/lec4.md" title="编辑此页">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"></path></svg>
</a>
<h1 id="xtuner"><span>XTuner<span class="heti-spacing"> </span></span>大模型单卡低成本微调实战<a class="headerlink" href="#xtuner" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h1>
<div style="margin-top: -30px; font-size: 0.75em; opacity: 0.7;">
<p><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2A10 10 0 0 0 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10h-2a8 8 0 0 1-8 8 8 8 0 0 1-8-8 8 8 0 0 1 8-8V2m6.78 1a.69.69 0 0 0-.48.2l-1.22 1.21 2.5 2.5L20.8 5.7c.26-.26.26-.7 0-.95L19.25 3.2c-.13-.13-.3-.2-.47-.2m-2.41 2.12L9 12.5V15h2.5l7.37-7.38-2.5-2.5z"></path></svg></span> 约<span class="heti-skip"><span class="heti-spacing"> </span>2467<span class="heti-spacing"> </span></span>个字 <span class="twemoji"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg></span> <span>534<span class="heti-spacing"> </span></span>行代码 <span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20c4.42 0 8-3.58 8-8s-3.58-8-8-8-8 3.58-8 8 3.58 8 8 8m0-18c5.5 0 10 4.5 10 10s-4.5 10-10 10C6.47 22 2 17.5 2 12S6.5 2 12 2m.5 11H11V7h1.5v4.26l3.7-2.13.75 1.3L12.5 13z"></path></svg></span> 预计阅读时间<span class="heti-skip"><span class="heti-spacing"> </span>15<span class="heti-spacing"> </span></span>分钟</p>
</div>
<div class="admonition abstract">
<p class="admonition-title">Abstract</p>
<p>学习自<a href="https://www.bilibili.com/video/BV1yK4y1B75J"><span class="heti-skip"><span class="heti-spacing"> </span>XTuner<span class="heti-spacing"> </span></span>大模型单卡低成本微调实战</a></p>
</div>
<h2 id="finetune">Finetune<a class="headerlink" href="#finetune" title="Permanent link">¶</a></h2>
<blockquote>
<p><span>LLM<span class="heti-spacing"> </span></span>的下游应用中，<strong>增量预训练</strong>和<strong>指令跟随</strong>是经常会用到两种的微调模式</p>
</blockquote>
<h3 id="_1">增量预训练微调<a class="headerlink" href="#_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>使用场景：让基座模型学习到一些新知识，如某个垂类领域的常识</li>
<li>
<p>训练数据：文章、书籍、代码等</p>
</li>
<li>
<p>为了让<span class="heti-skip"><span class="heti-spacing"> </span>LLM<span class="heti-spacing"> </span></span>知道什么时候开始一段话，什么时候结束一段话，实际训练时需要对数据添加起始符（BOS）和结束符（EOS<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，大多数的模型都是使用 <code>&lt;s&gt;</code> 作为起始符，<code>&lt;/s&gt;</code> 作为结束符</p>
</li>
</ul>
<h3 id="_2">指令跟随微调<a class="headerlink" href="#_2" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>使用场景：让模型学会对话模版，根据人类指令进行对话</li>
<li>训练数据：高质量的对话，问答数据</li>
</ul>
<div class="admonition example">
<p>在实际对话中，通常会有三种角色</p>
<ul>
<li><code>System</code> 给定一些上下文，比如“你是一个安全的<span class="heti-skip"><span class="heti-spacing"> </span>AI<span class="heti-spacing"> </span></span>助手”</li>
<li><code>User</code> 实际用户，会提出一些问题，比如 “世界第一高峰是”</li>
<li><code>Assistant</code> 根据<span class="heti-skip"><span class="heti-spacing"> </span>User<span class="heti-spacing"> </span></span>的输入，结合<span class="heti-skip"><span class="heti-spacing"> </span>System<span class="heti-spacing"> </span></span>的上下文信息，做出回答，比如 “珠穆朗玛峰”</li>
</ul>
<p><strong>在使用对话模型时，通常是不会感知到这三种角色</strong></p>
</div>
<ul>
<li>对话模版</li>
</ul>
<p></p><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/ft-1-chat-template.jpg"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/ft-1-chat-template.jpg"/></a></center>
<ul>
<li>不同于增量预训练微调，数据中会有<span class="heti-skip"><span class="heti-spacing"> </span>Input<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>Output<span class="heti-spacing"> </span></span>希望模型学会的是答案（Output<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，而不是问题（Input<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，训练时只会对答案（Output）部分计算<span><span class="heti-spacing"> </span>Loss</span></li>
<li>训练时，会和推理时保持一致，对数据添加相对应的对话模版</li>
</ul>
<h2 id="lora-qlora">LoRA &amp; QLoRA<a class="headerlink" href="#lora-qlora" title="Permanent link">¶</a></h2>
<p></p><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/LoRA-QLoRA.jpg"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/LoRA-QLoRA.jpg"/></a></center>
<h2 id="xtuner_1">Xtuner<a class="headerlink" href="#xtuner_1" title="Permanent link">¶</a></h2>
<ul>
<li><strong>傻瓜化</strong>：以 配置文件 的形式封装了大部分微调场景</li>
<li><strong>轻量级</strong>：对于<span class="heti-skip"><span class="heti-spacing"> </span>7B<span class="heti-spacing"> </span></span>参数量的<span><span class="heti-spacing"> </span>LLM</span>，微调所需的最小显存仅为<span><span class="heti-spacing"> </span>8GB</span></li>
</ul>
<h3 id="_3">快速上手<a class="headerlink" href="#_3" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_4">使用流程<a class="headerlink" href="#_4" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>安装</li>
</ol>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a>pip<span class="w"> </span>install<span class="w"> </span>xtuner
</code></pre></div>
<ol start="2">
<li>挑选配置模版</li>
</ol>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a>xtuner<span class="w"> </span>list-cfg<span class="w"> </span>-p<span class="w"> </span>internlm_20b
</code></pre></div>
<ol start="3">
<li>一键训练</li>
</ol>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>xtuner<span class="w"> </span>train<span class="w"> </span>internlm_20b_qlora_oasst1_512_e3
</code></pre></div>
<table>
<thead>
<tr>
<th>Config</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>模型名</td>
<td><span>internlm_20b (<span class="heti-spacing"> </span></span>无<span class="heti-skip"><span class="heti-spacing"> </span>chat<span class="heti-spacing"> </span></span>代表是基座模型<span><span class="heti-spacing"> </span>)</span></td>
</tr>
<tr>
<td>使用算法</td>
<td>qlora</td>
</tr>
<tr>
<td>数据集</td>
<td>oasst1</td>
</tr>
<tr>
<td>数据长度</td>
<td>512</td>
</tr>
<tr>
<td>Epoch</td>
<td>e3, epoch 3</td>
</tr>
</tbody>
</table>
<h4 id="_5">自定义训练<a class="headerlink" href="#_5" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ol>
<li>拷贝配置模版</li>
<li>修改配置模版</li>
<li>启动训练</li>
</ol>
<table>
<thead>
<tr>
<th>常用超参</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>data_path</td>
<td>数据路径或<span class="heti-skip"><span class="heti-spacing"> </span>HuggingFace<span class="heti-spacing"> </span></span>仓库名</td>
</tr>
<tr>
<td>max_length</td>
<td>单条数据最大<span class="heti-skip"><span class="heti-spacing"> </span>Token<span class="heti-spacing"> </span></span>数，超过则截断</td>
</tr>
<tr>
<td>pack_to_max_length</td>
<td>是否将多条短数据拼接到<span><span class="heti-spacing"> </span>max_length</span>，提高<span class="heti-skip"><span class="heti-spacing"> </span>GPU<span class="heti-spacing"> </span></span>利用率</td>
</tr>
<tr>
<td>accumulative_counts</td>
<td>梯度累积，每多少次<span class="heti-skip"><span class="heti-spacing"> </span>backward<span class="heti-spacing"> </span></span>更新一次参数</td>
</tr>
<tr>
<td>evaluation_inputs</td>
<td>训练过程中，会根据给定的问题进行推理，便于观测训练状态</td>
</tr>
<tr>
<td>evaluation_freq</td>
<td><span>Evaluation<span class="heti-spacing"> </span></span>的测评间隔<span class="heti-skip"><span class="heti-spacing"> </span>iter<span class="heti-spacing"> </span></span>数</td>
</tr>
</tbody>
</table>
<h4 id="_6">对话<a class="headerlink" href="#_6" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>为了便于开发者查看训练效果，<span>Xtuner<span class="heti-spacing"> </span></span>提供了一键对话借口</p>
<ol>
<li><span>Float16<span class="heti-spacing"> </span></span>模型对话</li>
</ol>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>xtuner<span class="w"> </span>chat<span class="w"> </span>internlm/internlm-chat-20b
</code></pre></div>
<ol start="2">
<li><span>4bits<span class="heti-spacing"> </span></span>模型对话</li>
</ol>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>xtuner<span class="w"> </span>chat<span class="w"> </span>internlm/internlm-chat-20b<span class="w"> </span>--bits<span class="w"> </span><span class="m">4</span>
</code></pre></div>
<ol start="3">
<li>加载<span class="heti-skip"><span class="heti-spacing"> </span>Adapter<span class="heti-spacing"> </span></span>模型对话</li>
</ol>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>xtuner<span class="w"> </span>chat<span class="w"> </span>internlm/internlm-chat-20b<span class="w"> </span>--adapter<span class="w"> </span><span class="nv">$ADAPTER_DIR</span>
</code></pre></div>
<p>同时，<span>Xtuner<span class="heti-spacing"> </span></span>还支持工具类模型的对话</p>
<h3 id="xtuner_2"><span>XTuner<span class="heti-spacing"> </span></span>数据引擎<a class="headerlink" href="#xtuner_2" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_7">数据处理流程<a class="headerlink" href="#_7" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p></p><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/xunter-pipe-1.jpg"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/xunter-pipe-1.jpg"/></a></center>
<h4 id="pack-dataset">多数据样本拼接（Pack Dataset）<a class="headerlink" href="#pack-dataset" title="Permanent link">¶</a></h4>
<p>增强并行性，充分利用<span class="heti-skip"><span class="heti-spacing"> </span>GPU<span class="heti-spacing"> </span></span>资源！</p>
<h2 id="8-gb-llm"><span>8 GB<span class="heti-spacing"> </span></span>显卡玩转<span><span class="heti-spacing"> </span>LLM</span><a class="headerlink" href="#8-gb-llm" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="xtuner_3"><span>XTuner<span class="heti-spacing"> </span></span>加速方式<a class="headerlink" href="#xtuner_3" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>
<p><code>Flash Attention</code>：<code>Flash Attention</code> 将 <code>Attention</code> 计算并行化，避免了计算过程中 <code>Attention Score NxN</code> 的显存占用（训练过程中的<span class="heti-skip"><span class="heti-spacing"> </span>N<span class="heti-spacing"> </span></span>都比较大）</p>
</li>
<li>
<p><code>DeepSpeed ZeRO</code></p>
<ul>
<li><code>ZeRO</code> 优化，通过将训练过程中的参数、梯度和优化器状态切片保存，能够在多<span class="heti-skip"><span class="heti-spacing"> </span>GPU<span class="heti-spacing"> </span></span>训练时显著节省显存</li>
<li>除了将训练中间状态切片外，<code>DeepSpeed</code> 训练时使用<span class="heti-skip"><span class="heti-spacing"> </span>FP16<span class="heti-spacing"> </span></span>的权重，相较于 <code>Pytorch</code> 的 <code>AMP</code> 训练，在单<span class="heti-skip"><span class="heti-spacing"> </span>GPU<span class="heti-spacing"> </span></span>上也能大幅节省显存</li>
</ul>
</li>
</ul>
<p></p><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/fa-dz.jpg"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/fa-dz.jpg"/></a></center>
<p><code>DeepSpeed</code> 与 <code>Flash Attention</code> 虽然能够大幅降低训练成本，但使用门槛相对较高，需要复杂的配置，甚至修改代码，为了让开发者专注于数据，<span>XTuner<span class="heti-spacing"> </span></span>会自动 <code>dispatch Flash Attention</code>，并一键启动 <code>DeepSpeed ZeRO</code></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>xtuner<span class="w"> </span>train<span class="w"> </span>internlm_20b_qlora_oasst1_512_e3<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="w">    </span>--deepspeed<span class="w"> </span>deepspeed_zero3
</code></pre></div>
<h2 id="_8">实战训练<a class="headerlink" href="#_8" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_9">环境<span class="heti-skip"><span class="heti-spacing"> </span>&amp;<span class="heti-spacing"> </span></span>安装<a class="headerlink" href="#_9" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>环境：Ubuntu + Anaconda + CUDA/CUDNN + 8GB Nvidia GPU</li>
<li>安装：</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a>conda<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>xtuner0.1.9<span class="w"> </span><span class="nv">python</span><span class="o">=</span><span class="m">3</span>.10<span class="w"> </span>-y
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>conda<span class="w"> </span>activate<span class="w"> </span>xtuner0.1.9
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="nb">cd</span><span class="w"> </span>~<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mkdir<span class="w"> </span>xtuner019<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>xtuner019
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>v0.1.9<span class="w">  </span>https://github.com/InternLM/xtuner
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="nb">cd</span><span class="w"> </span>xtuner
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span><span class="s1">'.[all]'</span>
</code></pre></div>
<ul>
<li>创建数据集工作路径：</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>mkdir<span class="w"> </span>~/ft-oasst1<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/ft-oasst1
</code></pre></div>
<h3 id="_10">微调<a class="headerlink" href="#_10" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_11">准备配置文件<a class="headerlink" href="#_11" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="nb">cd</span><span class="w"> </span>~/ft-oasst1
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>xtuner<span class="w"> </span>copy-cfg<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3<span class="w"> </span>.
</code></pre></div>
<h4 id="_12">模型下载<a class="headerlink" href="#_12" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<ul>
<li><span>InternStudio<span class="heti-spacing"> </span></span>平台上</li>
</ul>
<p></p><div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>cp<span class="w"> </span>-r<span class="w"> </span>/root/share/temp/model_repos/internlm-chat-7b<span class="w"> </span>~/ft-oasst1/
</code></pre></div>
- 不用 xtuner 默认的从 huggingface 拉取模型，而是提前从 ModelScope 下载模型到本地
<div class="highlight"><pre><span></span><code><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1"># 创建一个目录，放模型文件，防止散落一地</span>
<a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a>mkdir<span class="w"> </span>~/ft-oasst1/internlm-chat-7b
<a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a>
<a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="c1"># 装一下拉取模型文件要用的库</span>
<a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a>pip<span class="w"> </span>install<span class="w"> </span>modelscope
<a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a>
<a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="c1"># 从 modelscope 下载下载模型文件</span>
<a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="nb">cd</span><span class="w"> </span>~/ft-oasst1
<a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a>apt<span class="w"> </span>install<span class="w"> </span>git<span class="w"> </span>git-lfs<span class="w"> </span>-y
<a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a>git<span class="w"> </span>lfs<span class="w"> </span>install
<a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a>git<span class="w"> </span>lfs<span class="w"> </span>clone<span class="w"> </span>https://modelscope.cn/Shanghai_AI_Laboratory/internlm-chat-7b.git<span class="w"> </span>-b<span class="w"> </span>v1.0.3
</code></pre></div>
<h4 id="_13">数据集下载<a class="headerlink" href="#_13" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<blockquote>
<p><a href="https://huggingface.co/datasets/timdettmers/openassistant-guanaco/tree/main">https://huggingface.co/datasets/timdettmers/openassistant-guanaco/tree/main</a></p>
</blockquote>
<h4 id="_14">修改配置文件<a class="headerlink" href="#_14" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p>修改其中的模型和数据集为 本地路径</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="nb">cd</span><span class="w"> </span>~/ft-oasst1
<a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>vim<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3_copy.py
</code></pre></div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a># 修改模型为本地路径
<a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="gd">- pretrained_model_name_or_path = 'internlm/internlm-chat-7b'</span>
<a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="gi">+ pretrained_model_name_or_path = './internlm-chat-7b'</span>
<a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a>
<a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a># 修改训练数据集为本地路径
<a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="gd">- data_path = 'timdettmers/openassistant-guanaco'</span>
<a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="gi">+ data_path = './openassistant-guanaco'</span>
</code></pre></div>
<h4 id="_15">开始微调<a class="headerlink" href="#_15" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1"># 单卡</span>
<a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="c1">## 用刚才改好的config文件训练</span>
<a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a>xtuner<span class="w"> </span>train<span class="w"> </span>./internlm_chat_7b_qlora_oasst1_e3_copy.py
<a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a>
<a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="c1"># 多卡</span>
<a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="nv">NPROC_PER_NODE</span><span class="o">=</span><span class="si">${</span><span class="nv">GPU_NUM</span><span class="si">}</span><span class="w"> </span>xtuner<span class="w"> </span>train<span class="w"> </span>./internlm_chat_7b_qlora_oasst1_e3_copy.py
<a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a>
<a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="c1"># 若要开启 deepspeed 加速，增加 --deepspeed deepspeed_zero2 即可</span>
</code></pre></div>
<blockquote>
<p>微调得到的<span class="heti-skip"><span class="heti-spacing"> </span>PTH<span class="heti-spacing"> </span></span>模型文件和其他杂七杂八的文件都默认在当前的 <code>./work_dirs</code> 中。</p>
</blockquote>
<h4 id="adapter">生成<span class="heti-skip"><span class="heti-spacing"> </span>Adapter<span class="heti-spacing"> </span></span>文件<a class="headerlink" href="#adapter" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<blockquote>
<p>将得到的<span class="heti-skip"><span class="heti-spacing"> </span>PTH<span class="heti-spacing"> </span></span>模型转换为<span class="heti-skip"><span class="heti-spacing"> </span>HuggingFace<span class="heti-spacing"> </span></span>模型，即：生成<span class="heti-skip"><span class="heti-spacing"> </span>Adapter<span class="heti-spacing"> </span></span>文件夹
可以简单理解：LoRA 模型文件 = Adapter</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a>mkdir<span class="w"> </span>hf
<a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MKL_SERVICE_FORCE_INTEL</span><span class="o">=</span><span class="m">1</span>
<a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>
<a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a>xtuner<span class="w"> </span>convert<span class="w"> </span>pth_to_hf<span class="w"> </span>./internlm_chat_7b_qlora_oasst1_e3_copy.py<span class="w"> </span>./work_dirs/internlm_chat_7b_qlora_oasst1_e3_copy/epoch_1.pth<span class="w"> </span>./hf
</code></pre></div>
<h3 id="_16">部署与测试<a class="headerlink" href="#_16" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="huggingface-adapter">将<span class="heti-skip"><span class="heti-spacing"> </span>HuggingFace adapter<span class="heti-spacing"> </span></span>合并到大语言模型<a class="headerlink" href="#huggingface-adapter" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a>xtuner<span class="w"> </span>convert<span class="w"> </span>merge<span class="w"> </span>./internlm-chat-7b<span class="w"> </span>./hf<span class="w"> </span>./merged<span class="w"> </span>--max-shard-size<span class="w"> </span>2GB
<a href="#__codelineno-16-2" id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="c1"># xtuner convert merge \</span>
<a href="#__codelineno-16-3" id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="c1">#     ${NAME_OR_PATH_TO_LLM} \</span>
<a href="#__codelineno-16-4" id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="c1">#     ${NAME_OR_PATH_TO_ADAPTER} \</span>
<a href="#__codelineno-16-5" id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="c1">#     ${SAVE_PATH} \</span>
<a href="#__codelineno-16-6" id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="c1">#     --max-shard-size 2GB</span>
</code></pre></div>
<h4 id="_17">与合并后的模型对话<a class="headerlink" href="#_17" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="c1"># 加载 Adapter 模型对话（Float 16）</span>
<a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a>xtuner<span class="w"> </span>chat<span class="w"> </span>./merged<span class="w"> </span>--prompt-template<span class="w"> </span>internlm_chat
<a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a>
<a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="c1"># 4 bit 量化加载</span>
<a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="c1"># xtuner chat ./merged --bits 4 --prompt-template internlm_chat</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>微调前</th>
<th>微调后</th>
</tr>
</thead>
<tbody>
<tr>
<td><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/ft-before.png"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/ft-before.png"/></a></center></td>
<td><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/ft-after.png"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/ft-after.png"/></a></center></td>
</tr>
</tbody>
</table>
<h2 id="_18">自定义微调<a class="headerlink" href="#_18" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<blockquote>
<p>以 <strong><a href="https://github.com/abachaa/Medication_QA_MedInfo2019">Medication QA</a></strong> <strong>数据集</strong>为例</p>
</blockquote>
<h3 id="_19">概述<a class="headerlink" href="#_19" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_20"><strong>场景需求</strong><a class="headerlink" href="#_20" title="Permanent link">¶</a></h4>
<p>基于<span class="heti-skip"><span class="heti-spacing"> </span>InternLM-chat-7B<span class="heti-spacing"> </span></span>模型，用<span class="heti-skip"><span class="heti-spacing"> </span>MedQA<span class="heti-spacing"> </span></span>数据集进行微调，将其往<code>医学问答</code>领域对齐。</p>
<h4 id="_21"><strong>真实数据预览</strong><a class="headerlink" href="#_21" title="Permanent link">¶</a></h4>
<table>
<thead>
<tr>
<th>问题</th>
<th>答案</th>
</tr>
</thead>
<tbody>
<tr>
<td>What are ketorolac eye drops?（什么是酮咯酸滴眼液<heti-adjacent class="heti-adjacent-half">？</heti-adjacent>）</td>
<td>Ophthalmic   ketorolac is used to treat itchy eyes caused by allergies. It also is used to   treat swelling and redness (inflammation) that can occur after cataract   surgery. Ketorolac is in a class of medications called nonsteroidal   anti-inflammatory drugs (NSAIDs). It works by stopping the release of   substances that cause allergy symptoms and inflammation.</td>
</tr>
<tr>
<td>What medicines raise blood sugar? （什么药物会升高血糖<heti-adjacent class="heti-adjacent-half">？</heti-adjacent>）</td>
<td>Some   medicines for conditions other than diabetes can raise your blood sugar   level. This is a concern when you have diabetes. Make sure every doctor you   see knows about all of the medicines, vitamins, or herbal supplements you   take. This means anything you take with or without a prescription. Examples include:     Barbiturates.     Thiazide diuretics.     Corticosteroids.     Birth control pills (oral contraceptives) and progesterone.     Catecholamines.     Decongestants that contain beta-adrenergic agents, such as pseudoephedrine.     The B vitamin niacin. The risk of high blood sugar from niacin lowers after you have taken it for a few months. The antipsychotic medicine olanzapine (Zyprexa).</td>
</tr>
</tbody>
</table>
<h3 id="_22">数据准备<a class="headerlink" href="#_22" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<blockquote>
<p><strong>以</strong> <strong><a href="https://github.com/abachaa/Medication_QA_MedInfo2019">Medication QA</a></strong> <strong>数据集为例</strong></p>
</blockquote>
<p><strong>原格式：(.xlsx)</strong></p>
<table>
<thead>
<tr>
<th><strong>问题</strong></th>
<th>药物类型</th>
<th>问题类型</th>
<th><strong>回答</strong></th>
<th>主题</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>aaa</td>
<td>bbb</td>
<td>ccc</td>
<td>ddd</td>
<td>eee</td>
<td>fff</td>
</tr>
</tbody>
</table>
<h4 id="xtuner_4">将数据转为<span class="heti-skip"><span class="heti-spacing"> </span>XTuner<span class="heti-spacing"> </span></span>的数据格式<a class="headerlink" href="#xtuner_4" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<p><strong>目标格式：(.jsonL)</strong></p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="p">[{</span>
<a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">    </span><span class="nt">"conversation"</span><span class="p">:[</span>
<a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">        </span><span class="p">{</span>
<a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxx"</span><span class="p">,</span>
<a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">            </span><span class="nt">"input"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxx"</span><span class="p">,</span>
<a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">            </span><span class="nt">"output"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxx"</span>
<a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">    </span><span class="p">]</span>
<a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="p">},</span>
<a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="p">{</span>
<a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">    </span><span class="nt">"conversation"</span><span class="p">:[</span>
<a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">        </span><span class="p">{</span>
<a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">            </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxx"</span><span class="p">,</span>
<a href="#__codelineno-18-14" id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">            </span><span class="nt">"input"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxx"</span><span class="p">,</span>
<a href="#__codelineno-18-15" id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="w">            </span><span class="nt">"output"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xxx"</span>
<a href="#__codelineno-18-16" id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w">        </span><span class="p">}</span>
<a href="#__codelineno-18-17" id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="w">    </span><span class="p">]</span>
<a href="#__codelineno-18-18" id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="p">}]</span>
</code></pre></div>
<p>🧠通过<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>脚本：将 <code>.xlsx</code> 中的 问题 和 回答 两列 提取出来，再放入 <code>.jsonL</code> 文件的每个<span class="heti-skip"><span class="heti-spacing"> </span>conversation<span class="heti-spacing"> </span></span>的<span class="heti-skip"><span class="heti-spacing"> </span>input<span class="heti-spacing"> </span></span>和<span class="heti-skip"><span class="heti-spacing"> </span>output<span class="heti-spacing"> </span></span>中。</p>
<blockquote>
<p>这一步的<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>脚本可以请<span class="heti-skip"><span class="heti-spacing"> </span>ChatGPT<span class="heti-spacing"> </span></span>来完成。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a>Write a python file for me. using openpyxl. input file name is MedQA2019.xlsx
<a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>Step1: The input file is .xlsx. Exact the column A and column D in the sheet named "DrugQA" .
<a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a>Step2: Put each value in column A into each "input" of each "conversation". Put each value in column D into each "output" of each "conversation".
<a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a>Step3: The output file is .jsonL. It looks like:
<a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a>[{
<a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a>    "conversation":[
<a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a>        {
<a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a>            "system": "xxx",
<a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a>            "input": "xxx",
<a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a>            "output": "xxx"
<a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a>        }
<a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a>    ]
<a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a>},
<a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a>{
<a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a>    "conversation":[
<a href="#__codelineno-19-16" id="__codelineno-19-16" name="__codelineno-19-16"></a>        {
<a href="#__codelineno-19-17" id="__codelineno-19-17" name="__codelineno-19-17"></a>            "system": "xxx",
<a href="#__codelineno-19-18" id="__codelineno-19-18" name="__codelineno-19-18"></a>            "input": "xxx",
<a href="#__codelineno-19-19" id="__codelineno-19-19" name="__codelineno-19-19"></a>            "output": "xxx"
<a href="#__codelineno-19-20" id="__codelineno-19-20" name="__codelineno-19-20"></a>        }
<a href="#__codelineno-19-21" id="__codelineno-19-21" name="__codelineno-19-21"></a>    ]
<a href="#__codelineno-19-22" id="__codelineno-19-22" name="__codelineno-19-22"></a>}]
<a href="#__codelineno-19-23" id="__codelineno-19-23" name="__codelineno-19-23"></a>Step4: All "system" value changes to "You are a professional, highly experienced doctor professor. You always provide accurate, comprehensive, and detailed answers based on the patients' questions."
</code></pre></div>
<blockquote>
<p><span>ChatGPT<span class="heti-spacing"> </span></span>生成的<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>代码如下：</p>
</blockquote>
<details class="note">
<summary>xlsx2jsonl.py</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="kn">import</span> <span class="nn">openpyxl</span>
<a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="kn">import</span> <span class="nn">json</span>
<a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a>
<a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="k">def</span> <span class="nf">process_excel_to_json</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">):</span>
<a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a>    <span class="c1"># Load the workbook</span>
<a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a>    <span class="n">wb</span> <span class="o">=</span> <span class="n">openpyxl</span><span class="o">.</span><span class="n">load_workbook</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>
<a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a>
<a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a>    <span class="c1"># Select the "DrugQA" sheet</span>
<a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a>    <span class="n">sheet</span> <span class="o">=</span> <span class="n">wb</span><span class="p">[</span><span class="s2">"DrugQA"</span><span class="p">]</span>
<a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a>
<a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a>    <span class="c1"># Initialize the output data structure</span>
<a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a>    <span class="n">output_data</span> <span class="o">=</span> <span class="p">[]</span>
<a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a>
<a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a>    <span class="c1"># Iterate through each row in column A and D</span>
<a href="#__codelineno-20-15" id="__codelineno-20-15" name="__codelineno-20-15"></a>    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sheet</span><span class="o">.</span><span class="n">iter_rows</span><span class="p">(</span><span class="n">min_row</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">max_col</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">values_only</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a href="#__codelineno-20-16" id="__codelineno-20-16" name="__codelineno-20-16"></a>        <span class="n">system_value</span> <span class="o">=</span> <span class="s2">"You are a professional, highly experienced doctor professor. You always provide accurate, comprehensive, and detailed answers based on the patients' questions."</span>
<a href="#__codelineno-20-17" id="__codelineno-20-17" name="__codelineno-20-17"></a>
<a href="#__codelineno-20-18" id="__codelineno-20-18" name="__codelineno-20-18"></a>        <span class="c1"># Create the conversation dictionary</span>
<a href="#__codelineno-20-19" id="__codelineno-20-19" name="__codelineno-20-19"></a>        <span class="n">conversation</span> <span class="o">=</span> <span class="p">{</span>
<a href="#__codelineno-20-20" id="__codelineno-20-20" name="__codelineno-20-20"></a>            <span class="s2">"system"</span><span class="p">:</span> <span class="n">system_value</span><span class="p">,</span>
<a href="#__codelineno-20-21" id="__codelineno-20-21" name="__codelineno-20-21"></a>            <span class="s2">"input"</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a href="#__codelineno-20-22" id="__codelineno-20-22" name="__codelineno-20-22"></a>            <span class="s2">"output"</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<a href="#__codelineno-20-23" id="__codelineno-20-23" name="__codelineno-20-23"></a>        <span class="p">}</span>
<a href="#__codelineno-20-24" id="__codelineno-20-24" name="__codelineno-20-24"></a>
<a href="#__codelineno-20-25" id="__codelineno-20-25" name="__codelineno-20-25"></a>        <span class="c1"># Append the conversation to the output data</span>
<a href="#__codelineno-20-26" id="__codelineno-20-26" name="__codelineno-20-26"></a>        <span class="n">output_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">"conversation"</span><span class="p">:</span> <span class="p">[</span><span class="n">conversation</span><span class="p">]})</span>
<a href="#__codelineno-20-27" id="__codelineno-20-27" name="__codelineno-20-27"></a>
<a href="#__codelineno-20-28" id="__codelineno-20-28" name="__codelineno-20-28"></a>    <span class="c1"># Write the output data to a JSON file</span>
<a href="#__codelineno-20-29" id="__codelineno-20-29" name="__codelineno-20-29"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
<a href="#__codelineno-20-30" id="__codelineno-20-30" name="__codelineno-20-30"></a>        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">output_data</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a href="#__codelineno-20-31" id="__codelineno-20-31" name="__codelineno-20-31"></a>
<a href="#__codelineno-20-32" id="__codelineno-20-32" name="__codelineno-20-32"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Conversion complete. Output written to </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-20-33" id="__codelineno-20-33" name="__codelineno-20-33"></a>
<a href="#__codelineno-20-34" id="__codelineno-20-34" name="__codelineno-20-34"></a><span class="c1"># Replace 'MedQA2019.xlsx' and 'output.jsonl' with your actual input and output file names</span>
<a href="#__codelineno-20-35" id="__codelineno-20-35" name="__codelineno-20-35"></a><span class="n">process_excel_to_json</span><span class="p">(</span><span class="s1">'MedQA2019.xlsx'</span><span class="p">,</span> <span class="s1">'output.jsonl'</span><span class="p">)</span>
</code></pre></div>
</details>
<p>执行<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>脚本，获得格式化后的数据集：
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a>python<span class="w"> </span>xlsx2jsonl.py
</code></pre></div>
<p><strong>格式化后的数据集长这样：</strong></p>
<p></p><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/data-processed.png"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/data-processed.png"/></a></center>
<p>此时，当然也可以对数据进行训练集和测试集的分割，同样可以让<span class="heti-skip"><span class="heti-spacing"> </span>ChatGPT<span class="heti-spacing"> </span></span>写<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>代码。当然如果你没有严格的科研需求、不在乎“训练集泄露”的问题，也可以不做训练集与测试集的分割。</p>
<h4 id="_23">划分训练集和测试集<a class="headerlink" href="#_23" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a>my .jsonL file looks like:
<a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a>[{
<a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a>    "conversation":[
<a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a>        {
<a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a>            "system": "xxx",
<a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a>            "input": "xxx",
<a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a>            "output": "xxx"
<a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a>        }
<a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a>    ]
<a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a>},
<a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a>{
<a href="#__codelineno-22-12" id="__codelineno-22-12" name="__codelineno-22-12"></a>    "conversation":[
<a href="#__codelineno-22-13" id="__codelineno-22-13" name="__codelineno-22-13"></a>        {
<a href="#__codelineno-22-14" id="__codelineno-22-14" name="__codelineno-22-14"></a>            "system": "xxx",
<a href="#__codelineno-22-15" id="__codelineno-22-15" name="__codelineno-22-15"></a>            "input": "xxx",
<a href="#__codelineno-22-16" id="__codelineno-22-16" name="__codelineno-22-16"></a>            "output": "xxx"
<a href="#__codelineno-22-17" id="__codelineno-22-17" name="__codelineno-22-17"></a>        }
<a href="#__codelineno-22-18" id="__codelineno-22-18" name="__codelineno-22-18"></a>    ]
<a href="#__codelineno-22-19" id="__codelineno-22-19" name="__codelineno-22-19"></a>}]
<a href="#__codelineno-22-20" id="__codelineno-22-20" name="__codelineno-22-20"></a>Step1, read the .jsonL file.
<a href="#__codelineno-22-21" id="__codelineno-22-21" name="__codelineno-22-21"></a>Step2, count the amount of the "conversation" elements.
<a href="#__codelineno-22-22" id="__codelineno-22-22" name="__codelineno-22-22"></a>Step3, randomly split all "conversation" elements by 7:3. Targeted structure is same as the input.
<a href="#__codelineno-22-23" id="__codelineno-22-23" name="__codelineno-22-23"></a>Step4, save the 7/10 part as train.jsonl. save the 3/10 part as test.jsonl
</code></pre></div>
<blockquote>
<p>生成的<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>代码如下：</p>
</blockquote>
<details class="note">
<summary>split2train_and_test.py</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="kn">import</span> <span class="nn">json</span>
<a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="kn">import</span> <span class="nn">random</span>
<a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a>
<a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="k">def</span> <span class="nf">split_conversations</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="n">train_output_file</span><span class="p">,</span> <span class="n">test_output_file</span><span class="p">):</span>
<a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a>    <span class="c1"># Read the input JSONL file</span>
<a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonl_file</span><span class="p">:</span>
<a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">jsonl_file</span><span class="p">)</span>
<a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a>
<a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a>    <span class="c1"># Count the number of conversation elements</span>
<a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a>    <span class="n">num_conversations</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a>
<a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a>    <span class="c1"># Shuffle the data randomly</span>
<a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a>    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a>    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a>    <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a>
<a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a>    <span class="c1"># Calculate the split points for train and test</span>
<a href="#__codelineno-23-18" id="__codelineno-23-18" name="__codelineno-23-18"></a>    <span class="n">split_point</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">num_conversations</span> <span class="o">*</span> <span class="mf">0.7</span><span class="p">)</span>
<a href="#__codelineno-23-19" id="__codelineno-23-19" name="__codelineno-23-19"></a>
<a href="#__codelineno-23-20" id="__codelineno-23-20" name="__codelineno-23-20"></a>    <span class="c1"># Split the data into train and test</span>
<a href="#__codelineno-23-21" id="__codelineno-23-21" name="__codelineno-23-21"></a>    <span class="n">train_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:</span><span class="n">split_point</span><span class="p">]</span>
<a href="#__codelineno-23-22" id="__codelineno-23-22" name="__codelineno-23-22"></a>    <span class="n">test_data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">split_point</span><span class="p">:]</span>
<a href="#__codelineno-23-23" id="__codelineno-23-23" name="__codelineno-23-23"></a>
<a href="#__codelineno-23-24" id="__codelineno-23-24" name="__codelineno-23-24"></a>    <span class="c1"># Write the train data to a new JSONL file</span>
<a href="#__codelineno-23-25" id="__codelineno-23-25" name="__codelineno-23-25"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">train_output_file</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">train_jsonl_file</span><span class="p">:</span>
<a href="#__codelineno-23-26" id="__codelineno-23-26" name="__codelineno-23-26"></a>        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_jsonl_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a href="#__codelineno-23-27" id="__codelineno-23-27" name="__codelineno-23-27"></a>
<a href="#__codelineno-23-28" id="__codelineno-23-28" name="__codelineno-23-28"></a>    <span class="c1"># Write the test data to a new JSONL file</span>
<a href="#__codelineno-23-29" id="__codelineno-23-29" name="__codelineno-23-29"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">test_output_file</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">test_jsonl_file</span><span class="p">:</span>
<a href="#__codelineno-23-30" id="__codelineno-23-30" name="__codelineno-23-30"></a>        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">test_jsonl_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<a href="#__codelineno-23-31" id="__codelineno-23-31" name="__codelineno-23-31"></a>
<a href="#__codelineno-23-32" id="__codelineno-23-32" name="__codelineno-23-32"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Split complete. Train data written to </span><span class="si">{</span><span class="n">train_output_file</span><span class="si">}</span><span class="s2">, Test data written to </span><span class="si">{</span><span class="n">test_output_file</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-23-33" id="__codelineno-23-33" name="__codelineno-23-33"></a>
<a href="#__codelineno-23-34" id="__codelineno-23-34" name="__codelineno-23-34"></a><span class="c1"># Replace 'input.jsonl', 'train.jsonl', and 'test.jsonl' with your actual file names</span>
<a href="#__codelineno-23-35" id="__codelineno-23-35" name="__codelineno-23-35"></a><span class="n">split_conversations</span><span class="p">(</span><span class="s1">'MedQA2019-structured.jsonl'</span><span class="p">,</span> <span class="s1">'MedQA2019-structured-train.jsonl'</span><span class="p">,</span> <span class="s1">'MedQA2019-structured-test.jsonl'</span><span class="p">)</span>
</code></pre></div>
</details>
<h3 id="_24">开始自定义微调<a class="headerlink" href="#_24" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p>此时，我们重新建一个文件夹来玩“微调自定义数据集”
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a>mkdir<span class="w"> </span>~/ft-medqa<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/ft-medqa
</code></pre></div>
<p>把前面下载好的<span class="heti-skip"><span class="heti-spacing"> </span>internlm-chat-7b<span class="heti-spacing"> </span></span>模型文件夹拷贝过来。</p>
<p></p><div class="highlight"><pre><span></span><code><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a>cp<span class="w"> </span>-r<span class="w"> </span>~/ft-oasst1/internlm-chat-7b<span class="w"> </span>.
</code></pre></div>
别忘了把自定义数据集，即几个 <code>.jsonL</code>，也传到服务器上。
<div class="highlight"><pre><span></span><code><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/InternLM/tutorial
</code></pre></div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a>cp<span class="w"> </span>~/tutorial/xtuner/MedQA2019-structured-train.jsonl<span class="w"> </span>.
</code></pre></div>
<h4 id="_25">准备配置文件<a class="headerlink" href="#_25" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a><span class="c1"># 复制配置文件到当前目录</span>
<a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a>xtuner<span class="w"> </span>copy-cfg<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3<span class="w"> </span>.
<a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="c1"># 改个文件名</span>
<a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a>mv<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3_copy.py<span class="w"> </span>internlm_chat_7b_qlora_medqa2019_e3.py
<a href="#__codelineno-28-5" id="__codelineno-28-5" name="__codelineno-28-5"></a>
<a href="#__codelineno-28-6" id="__codelineno-28-6" name="__codelineno-28-6"></a><span class="c1"># 修改配置文件内容</span>
<a href="#__codelineno-28-7" id="__codelineno-28-7" name="__codelineno-28-7"></a>vim<span class="w"> </span>internlm_chat_7b_qlora_medqa2019_e3.py
</code></pre></div>
<p>减号代表要删除的行，加号代表要增加的行。
</p><div class="highlight"><pre><span></span><code><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a># 修改import部分
<a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="gd">- from xtuner.dataset.map_fns import oasst1_map_fn, template_map_fn_factory</span>
<a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="gi">+ from xtuner.dataset.map_fns import template_map_fn_factory</span>
<a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a>
<a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a># 修改模型为本地路径
<a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="gd">- pretrained_model_name_or_path = 'internlm/internlm-chat-7b'</span>
<a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="gi">+ pretrained_model_name_or_path = './internlm-chat-7b'</span>
<a href="#__codelineno-29-8" id="__codelineno-29-8" name="__codelineno-29-8"></a>
<a href="#__codelineno-29-9" id="__codelineno-29-9" name="__codelineno-29-9"></a># 修改训练数据为 MedQA2019-structured-train.jsonl 路径
<a href="#__codelineno-29-10" id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="gd">- data_path = 'timdettmers/openassistant-guanaco'</span>
<a href="#__codelineno-29-11" id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="gi">+ data_path = 'MedQA2019-structured-train.jsonl'</span>
<a href="#__codelineno-29-12" id="__codelineno-29-12" name="__codelineno-29-12"></a>
<a href="#__codelineno-29-13" id="__codelineno-29-13" name="__codelineno-29-13"></a># 修改 train_dataset 对象
<a href="#__codelineno-29-14" id="__codelineno-29-14" name="__codelineno-29-14"></a>train_dataset = dict(
<a href="#__codelineno-29-15" id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="w"> </span>   type=process_hf_dataset,
<a href="#__codelineno-29-16" id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="gd">-   dataset=dict(type=load_dataset, path=data_path),</span>
<a href="#__codelineno-29-17" id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="gi">+   dataset=dict(type=load_dataset, path='json', data_files=dict(train=data_path)),</span>
<a href="#__codelineno-29-18" id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="w"> </span>   tokenizer=tokenizer,
<a href="#__codelineno-29-19" id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w"> </span>   max_length=max_length,
<a href="#__codelineno-29-20" id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="gd">-   dataset_map_fn=alpaca_map_fn,</span>
<a href="#__codelineno-29-21" id="__codelineno-29-21" name="__codelineno-29-21"></a><span class="gi">+   dataset_map_fn=None,</span>
<a href="#__codelineno-29-22" id="__codelineno-29-22" name="__codelineno-29-22"></a><span class="w"> </span>   template_map_fn=dict(
<a href="#__codelineno-29-23" id="__codelineno-29-23" name="__codelineno-29-23"></a><span class="w"> </span>       type=template_map_fn_factory, template=prompt_template),
<a href="#__codelineno-29-24" id="__codelineno-29-24" name="__codelineno-29-24"></a><span class="w"> </span>   remove_unused_columns=True,
<a href="#__codelineno-29-25" id="__codelineno-29-25" name="__codelineno-29-25"></a><span class="w"> </span>   shuffle_before_pack=True,
<a href="#__codelineno-29-26" id="__codelineno-29-26" name="__codelineno-29-26"></a><span class="w"> </span>   pack_to_max_length=pack_to_max_length)
</code></pre></div>
<h4 id="xtuner_5">XTuner！启动！<a class="headerlink" href="#xtuner_5" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a>xtuner<span class="w"> </span>train<span class="w"> </span>internlm_chat_7b_qlora_medqa2019_e3.py<span class="w"> </span>--deepspeed<span class="w"> </span>deepspeed_zero2
</code></pre></div>
<h4 id="adapter_1">生成<span class="heti-skip"><span class="heti-spacing"> </span>Adapter<span class="heti-spacing"> </span></span>文件<a class="headerlink" href="#adapter_1" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<h4 id="_26">部署与测试<a class="headerlink" href="#_26" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<h2 id="ms-agent-llm-agent">用<span class="heti-skip"><span class="heti-spacing"> </span>MS-Agent<span class="heti-spacing"> </span></span>数据集赋予<span class="heti-skip"><span class="heti-spacing"> </span>LLM<span class="heti-spacing"> </span></span>以<span class="heti-skip"><span class="heti-spacing"> </span>Agent<span class="heti-spacing"> </span></span>能力<a class="headerlink" href="#ms-agent-llm-agent" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_27">概述<a class="headerlink" href="#_27" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<p><span>MSAgent<span class="heti-spacing"> </span></span>数据集每条样本包含一个对话列表（conversations<heti-adjacent class="heti-adjacent-half">）</heti-adjacent>，其里面包含了<span><span class="heti-spacing"> </span>system</span>、user、<span>assistant<span class="heti-spacing"> </span></span>三种字段。其中：</p>
<ul>
<li>
<p><span>system:<span class="heti-spacing"> </span></span>表示给模型前置的人设输入，其中有告诉模型如何调用插件以及生成请求</p>
</li>
<li>
<p><span>user:<span class="heti-spacing"> </span></span>表示用户的输入<span><span class="heti-spacing"> </span>prompt</span>，分为两种，通用生成的<span class="heti-skip"><span class="heti-spacing"> </span>prompt<span class="heti-spacing"> </span></span>和调用插件需求的<span><span class="heti-spacing"> </span>prompt</span></p>
</li>
<li>
<p><span>assistant:<span class="heti-spacing"> </span></span>为模型的回复。其中会包括插件调用代码和执行代码，调用代码是要<span class="heti-skip"><span class="heti-spacing"> </span>LLM<span class="heti-spacing"> </span></span>生成的，而执行代码是调用服务来生成结果的</p>
</li>
</ul>
<p>一条调用网页搜索插件查询“上海明天天气”的数据样本示例如下图所示：</p>
<p></p><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/msagent_data.png"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/msagent_data.png"/></a></center>
<h3 id="_28">微调步骤<a class="headerlink" href="#_28" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<h4 id="_29">准备工作<a class="headerlink" href="#_29" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<blockquote>
<p><span>xtuner<span class="heti-spacing"> </span></span>是从国内的<span class="heti-skip"><span class="heti-spacing"> </span>ModelScope<span class="heti-spacing"> </span></span>平台下载<span class="heti-skip"><span class="heti-spacing"> </span>MS-Agent<span class="heti-spacing"> </span></span>数据集，因此不用提前手动下载数据集文件。</p>
</blockquote>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="c1"># 准备工作</span>
<a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a>mkdir<span class="w"> </span>~/ft-msagent<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>~/ft-msagent
<a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a>cp<span class="w"> </span>-r<span class="w"> </span>~/ft-oasst1/internlm-chat-7b<span class="w"> </span>.
<a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a>
<a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="c1"># 查看配置文件</span>
<a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a>xtuner<span class="w"> </span>list-cfg<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>msagent
<a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a>
<a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="c1"># 复制配置文件到当前目录</span>
<a href="#__codelineno-31-9" id="__codelineno-31-9" name="__codelineno-31-9"></a>xtuner<span class="w"> </span>copy-cfg<span class="w"> </span>internlm_7b_qlora_msagent_react_e3_gpu8<span class="w"> </span>.
<a href="#__codelineno-31-10" id="__codelineno-31-10" name="__codelineno-31-10"></a>
<a href="#__codelineno-31-11" id="__codelineno-31-11" name="__codelineno-31-11"></a><span class="c1"># 修改配置文件中的模型为本地路径</span>
<a href="#__codelineno-31-12" id="__codelineno-31-12" name="__codelineno-31-12"></a>vim<span class="w"> </span>./internlm_7b_qlora_msagent_react_e3_gpu8_copy.py<span class="w"> </span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="gd">- pretrained_model_name_or_path = 'internlm/internlm-chat-7b'</span>
<a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="gi">+ pretrained_model_name_or_path = './internlm-chat-7b'</span>
</code></pre></div>
<h4 id="_30">开始微调<a class="headerlink" href="#_30" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a>xtuner<span class="w"> </span>train<span class="w"> </span>./internlm_7b_qlora_msagent_react_e3_gpu8_copy.py<span class="w"> </span>--deepspeed<span class="w"> </span>deepspeed_zero2
</code></pre></div>
<h3 id="_31">直接使用<a class="headerlink" href="#_31" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<blockquote>
<p>由于<span class="heti-skip"><span class="heti-spacing"> </span>msagent<span class="heti-spacing"> </span></span>的训练非常费时，大家如果想尽快把这个教程跟完，可以直接从<span class="heti-skip"><span class="heti-spacing"> </span>modelScope<span class="heti-spacing"> </span></span>拉取咱们已经微调好了的<span><span class="heti-spacing"> </span>Adapter</span>。如下演示。</p>
</blockquote>
<h4 id="adapter_2">下载<span><span class="heti-spacing"> </span>Adapter</span><a class="headerlink" href="#adapter_2" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="nb">cd</span><span class="w"> </span>~/ft-msagent
<a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a>apt<span class="w"> </span>install<span class="w"> </span>git<span class="w"> </span>git-lfs
<a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a>git<span class="w"> </span>lfs<span class="w"> </span>install
<a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a>git<span class="w"> </span>lfs<span class="w"> </span>clone<span class="w"> </span>https://www.modelscope.cn/xtuner/internlm-7b-qlora-msagent-react.git
</code></pre></div>
<p>有了这个在<span class="heti-skip"><span class="heti-spacing"> </span>msagent<span class="heti-spacing"> </span></span>上训练得到的<span><span class="heti-spacing"> </span>Adapter</span>，模型现在已经有<span class="heti-skip"><span class="heti-spacing"> </span>agent<span class="heti-spacing"> </span></span>能力了！就可以加<span class="heti-skip"><span class="heti-spacing"> </span>--lagent<span class="heti-spacing"> </span></span>以调用来自<span class="heti-skip"><span class="heti-spacing"> </span>lagent<span class="heti-spacing"> </span></span>的代理功能了！</p>
<h4 id="serper">添加<span class="heti-skip"><span class="heti-spacing"> </span>serper<span class="heti-spacing"> </span></span>环境变量<a class="headerlink" href="#serper" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h4>
<blockquote>
<p><strong>开始<span class="heti-skip"><span class="heti-spacing"> </span>chat<span class="heti-spacing"> </span></span>之前，还要加个<span class="heti-skip"><span class="heti-spacing"> </span>serper<span class="heti-spacing"> </span></span>的环境变量：</strong></p>
<p>去<span class="heti-skip"><span class="heti-spacing"> </span>serper.dev<span class="heti-spacing"> </span></span>免费注册一个账号，生成自己的<span><span class="heti-spacing"> </span>api key</span>。这个东西是用来给<span class="heti-skip"><span class="heti-spacing"> </span>lagent<span class="heti-spacing"> </span></span>去获取<span class="heti-skip"><span class="heti-spacing"> </span>google<span class="heti-spacing"> </span></span>搜索的结果的。等于是<span class="heti-skip"><span class="heti-spacing"> </span>serper.dev<span class="heti-spacing"> </span></span>帮你去访问<span><span class="heti-spacing"> </span>google</span>，而不是从你自己本地去访问<span class="heti-skip"><span class="heti-spacing"> </span>google<span class="heti-spacing"> </span></span>了。</p>
</blockquote>
<p>添加<span class="heti-skip"><span class="heti-spacing"> </span>serper api key<span class="heti-spacing"> </span></span>到环境变量：</p>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">SERPER_API_KEY</span><span class="o">=</span>abcdefg
</code></pre></div>
<h4 id="xtuner-agent">xtuner + agent，启动！<a class="headerlink" href="#xtuner-agent" title="Permanent link">¶</a></h4>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a>xtuner<span class="w"> </span>chat<span class="w"> </span>./internlm-chat-7b<span class="w"> </span>--adapter<span class="w"> </span>internlm-7b-qlora-msagent-react<span class="w"> </span>--lagent<span class="w"> </span>--prompt-template<span class="w"> </span>internlm_chat
</code></pre></div>
<h2 id="xtuner-internlm-chat">作业：<span>XTuner InternLM-Chat<span class="heti-spacing"> </span></span>个人小助手认知微调实践<a class="headerlink" href="#xtuner-internlm-chat" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<h3 id="_32">环境准备<a class="headerlink" href="#_32" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-37-1" id="__codelineno-37-1" name="__codelineno-37-1"></a><span class="c1"># InternStudio 平台中，从本地 clone 一个已有 pytorch 2.0.1 的环境（后续均在该环境执行，若为其他环境可作为参考）</span>
<a href="#__codelineno-37-2" id="__codelineno-37-2" name="__codelineno-37-2"></a><span class="c1"># 进入环境后首先 bash</span>
<a href="#__codelineno-37-3" id="__codelineno-37-3" name="__codelineno-37-3"></a><span class="c1"># 进入环境后首先 bash</span>
<a href="#__codelineno-37-4" id="__codelineno-37-4" name="__codelineno-37-4"></a><span class="c1"># 进入环境后首先 bash</span>
<a href="#__codelineno-37-5" id="__codelineno-37-5" name="__codelineno-37-5"></a>bash
<a href="#__codelineno-37-6" id="__codelineno-37-6" name="__codelineno-37-6"></a>conda<span class="w"> </span>create<span class="w"> </span>--name<span class="w"> </span>personal_assistant<span class="w"> </span>--clone<span class="o">=</span>/root/share/conda_envs/internlm-base
<a href="#__codelineno-37-7" id="__codelineno-37-7" name="__codelineno-37-7"></a><span class="c1"># 如果在其他平台：</span>
<a href="#__codelineno-37-8" id="__codelineno-37-8" name="__codelineno-37-8"></a><span class="c1"># conda create --name personal_assistant python=3.10 -y</span>
<a href="#__codelineno-37-9" id="__codelineno-37-9" name="__codelineno-37-9"></a>
<a href="#__codelineno-37-10" id="__codelineno-37-10" name="__codelineno-37-10"></a><span class="c1"># 激活环境</span>
<a href="#__codelineno-37-11" id="__codelineno-37-11" name="__codelineno-37-11"></a>conda<span class="w"> </span>activate<span class="w"> </span>personal_assistant
<a href="#__codelineno-37-12" id="__codelineno-37-12" name="__codelineno-37-12"></a><span class="c1"># 进入家目录 （~的意思是 “当前用户的home路径”）</span>
<a href="#__codelineno-37-13" id="__codelineno-37-13" name="__codelineno-37-13"></a><span class="nb">cd</span><span class="w"> </span>~
<a href="#__codelineno-37-14" id="__codelineno-37-14" name="__codelineno-37-14"></a><span class="c1"># 创建版本文件夹并进入，以跟随本教程</span>
<a href="#__codelineno-37-15" id="__codelineno-37-15" name="__codelineno-37-15"></a><span class="c1"># personal_assistant用于存放本教程所使用的东西</span>
<a href="#__codelineno-37-16" id="__codelineno-37-16" name="__codelineno-37-16"></a>mkdir<span class="w"> </span>/root/personal_assistant<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/root/personal_assistant
<a href="#__codelineno-37-17" id="__codelineno-37-17" name="__codelineno-37-17"></a>mkdir<span class="w"> </span>/root/personal_assistant/xtuner019<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/root/personal_assistant/xtuner019
<a href="#__codelineno-37-18" id="__codelineno-37-18" name="__codelineno-37-18"></a>
<a href="#__codelineno-37-19" id="__codelineno-37-19" name="__codelineno-37-19"></a><span class="c1"># 拉取 0.1.9 的版本源码</span>
<a href="#__codelineno-37-20" id="__codelineno-37-20" name="__codelineno-37-20"></a>git<span class="w"> </span>clone<span class="w"> </span>-b<span class="w"> </span>v0.1.9<span class="w">  </span>https://github.com/InternLM/xtuner
<a href="#__codelineno-37-21" id="__codelineno-37-21" name="__codelineno-37-21"></a><span class="c1"># 无法访问github的用户请从 gitee 拉取:</span>
<a href="#__codelineno-37-22" id="__codelineno-37-22" name="__codelineno-37-22"></a><span class="c1"># git clone -b v0.1.9 https://gitee.com/Internlm/xtuner</span>
<a href="#__codelineno-37-23" id="__codelineno-37-23" name="__codelineno-37-23"></a>
<a href="#__codelineno-37-24" id="__codelineno-37-24" name="__codelineno-37-24"></a><span class="c1"># 进入源码目录</span>
<a href="#__codelineno-37-25" id="__codelineno-37-25" name="__codelineno-37-25"></a><span class="nb">cd</span><span class="w"> </span>xtuner
<a href="#__codelineno-37-26" id="__codelineno-37-26" name="__codelineno-37-26"></a>
<a href="#__codelineno-37-27" id="__codelineno-37-27" name="__codelineno-37-27"></a><span class="c1"># 从源码安装 XTuner</span>
<a href="#__codelineno-37-28" id="__codelineno-37-28" name="__codelineno-37-28"></a>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span><span class="s1">'.[all]'</span>
</code></pre></div>
<h3 id="_33">数据准备<a class="headerlink" href="#_33" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-38-1" id="__codelineno-38-1" name="__codelineno-38-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/root/personal_assistant/data<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/root/personal_assistant/data
</code></pre></div>
<p>在 <code>data</code> 目录下创建一个<span class="heti-skip"><span class="heti-spacing"> </span>json<span class="heti-spacing"> </span></span>文件 <code>personal_assistant.json</code> 作为本次微调所使用的数据集。</p>
<p>其中 <code>conversation</code> 表示一次对话的内容，<code>input</code> 为输入，即用户会问的问题，<code>output</code> 为输出，即想要模型回答的答案。</p>
<p>以下是一个<span class="heti-skip"><span class="heti-spacing"> </span>python<span class="heti-spacing"> </span></span>脚本，用于生成数据集。</p>
<details class="note">
<summary>generate_data.py</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-39-1" id="__codelineno-39-1" name="__codelineno-39-1"></a><span class="kn">import</span> <span class="nn">json</span>
<a href="#__codelineno-39-2" id="__codelineno-39-2" name="__codelineno-39-2"></a>
<a href="#__codelineno-39-3" id="__codelineno-39-3" name="__codelineno-39-3"></a><span class="c1"># 输入你的名字</span>
<a href="#__codelineno-39-4" id="__codelineno-39-4" name="__codelineno-39-4"></a><span class="n">name</span> <span class="o">=</span> <span class="s1">'狙击美佐'</span>
<a href="#__codelineno-39-5" id="__codelineno-39-5" name="__codelineno-39-5"></a><span class="c1"># 重复次数</span>
<a href="#__codelineno-39-6" id="__codelineno-39-6" name="__codelineno-39-6"></a><span class="n">n</span> <span class="o">=</span> <span class="mi">10000</span>
<a href="#__codelineno-39-7" id="__codelineno-39-7" name="__codelineno-39-7"></a>
<a href="#__codelineno-39-8" id="__codelineno-39-8" name="__codelineno-39-8"></a><span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
<a href="#__codelineno-39-9" id="__codelineno-39-9" name="__codelineno-39-9"></a>    <span class="p">{</span>
<a href="#__codelineno-39-10" id="__codelineno-39-10" name="__codelineno-39-10"></a>        <span class="s2">"conversation"</span><span class="p">:</span> <span class="p">[</span>
<a href="#__codelineno-39-11" id="__codelineno-39-11" name="__codelineno-39-11"></a>            <span class="p">{</span>
<a href="#__codelineno-39-12" id="__codelineno-39-12" name="__codelineno-39-12"></a>                <span class="s2">"input"</span><span class="p">:</span> <span class="s2">"请做一下自我介绍"</span><span class="p">,</span>
<a href="#__codelineno-39-13" id="__codelineno-39-13" name="__codelineno-39-13"></a>                <span class="s2">"output"</span><span class="p">:</span> <span class="s2">"我是</span><span class="si">{}</span><span class="s2">的小助手，内在是上海AI实验室书生·浦语的7B大模型哦"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a href="#__codelineno-39-14" id="__codelineno-39-14" name="__codelineno-39-14"></a>            <span class="p">}</span>
<a href="#__codelineno-39-15" id="__codelineno-39-15" name="__codelineno-39-15"></a>        <span class="p">]</span>
<a href="#__codelineno-39-16" id="__codelineno-39-16" name="__codelineno-39-16"></a>    <span class="p">}</span>
<a href="#__codelineno-39-17" id="__codelineno-39-17" name="__codelineno-39-17"></a><span class="p">]</span>
<a href="#__codelineno-39-18" id="__codelineno-39-18" name="__codelineno-39-18"></a>
<a href="#__codelineno-39-19" id="__codelineno-39-19" name="__codelineno-39-19"></a><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<a href="#__codelineno-39-20" id="__codelineno-39-20" name="__codelineno-39-20"></a>    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a href="#__codelineno-39-21" id="__codelineno-39-21" name="__codelineno-39-21"></a>
<a href="#__codelineno-39-22" id="__codelineno-39-22" name="__codelineno-39-22"></a><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'personal_assistant.json'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">'utf-8'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a href="#__codelineno-39-23" id="__codelineno-39-23" name="__codelineno-39-23"></a>    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</code></pre></div>
</details>
<h3 id="_34">配置准备<a class="headerlink" href="#_34" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-40-1" id="__codelineno-40-1" name="__codelineno-40-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>/root/personal_assistant/model/Shanghai_AI_Laboratory
<a href="#__codelineno-40-2" id="__codelineno-40-2" name="__codelineno-40-2"></a>cp<span class="w"> </span>-r<span class="w"> </span>/root/share/temp/model_repos/internlm-chat-7b<span class="w"> </span>/root/personal_assistant/model/Shanghai_AI_Laboratory
</code></pre></div>
<p></p><div class="highlight"><pre><span></span><code><a href="#__codelineno-41-1" id="__codelineno-41-1" name="__codelineno-41-1"></a><span class="c1"># 创建用于存放配置的文件夹config并进入</span>
<a href="#__codelineno-41-2" id="__codelineno-41-2" name="__codelineno-41-2"></a>mkdir<span class="w"> </span>/root/personal_assistant/config<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/root/personal_assistant/config
<a href="#__codelineno-41-3" id="__codelineno-41-3" name="__codelineno-41-3"></a><span class="c1"># 拷贝一个配置文件到当前目录</span>
<a href="#__codelineno-41-4" id="__codelineno-41-4" name="__codelineno-41-4"></a>xtuner<span class="w"> </span>copy-cfg<span class="w"> </span>internlm_chat_7b_qlora_oasst1_e3<span class="w"> </span>.
</code></pre></div>
修改拷贝后的文件：
<details class="note">
<summary>internlm_chat_7b_qlora_oasst1_e3_copy.py</summary>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-42-1" id="__codelineno-42-1" name="__codelineno-42-1"></a><span class="c1"># Copyright (c) OpenMMLab. All rights reserved.</span>
<a href="#__codelineno-42-2" id="__codelineno-42-2" name="__codelineno-42-2"></a><span class="kn">import</span> <span class="nn">torch</span>
<a href="#__codelineno-42-3" id="__codelineno-42-3" name="__codelineno-42-3"></a><span class="kn">from</span> <span class="nn">bitsandbytes.optim</span> <span class="kn">import</span> <span class="n">PagedAdamW32bit</span>
<a href="#__codelineno-42-4" id="__codelineno-42-4" name="__codelineno-42-4"></a><span class="kn">from</span> <span class="nn">datasets</span> <span class="kn">import</span> <span class="n">load_dataset</span>
<a href="#__codelineno-42-5" id="__codelineno-42-5" name="__codelineno-42-5"></a><span class="kn">from</span> <span class="nn">mmengine.dataset</span> <span class="kn">import</span> <span class="n">DefaultSampler</span>
<a href="#__codelineno-42-6" id="__codelineno-42-6" name="__codelineno-42-6"></a><span class="kn">from</span> <span class="nn">mmengine.hooks</span> <span class="kn">import</span> <span class="p">(</span><span class="n">CheckpointHook</span><span class="p">,</span> <span class="n">DistSamplerSeedHook</span><span class="p">,</span> <span class="n">IterTimerHook</span><span class="p">,</span>
<a href="#__codelineno-42-7" id="__codelineno-42-7" name="__codelineno-42-7"></a>                            <span class="n">LoggerHook</span><span class="p">,</span> <span class="n">ParamSchedulerHook</span><span class="p">)</span>
<a href="#__codelineno-42-8" id="__codelineno-42-8" name="__codelineno-42-8"></a><span class="kn">from</span> <span class="nn">mmengine.optim</span> <span class="kn">import</span> <span class="n">AmpOptimWrapper</span><span class="p">,</span> <span class="n">CosineAnnealingLR</span>
<a href="#__codelineno-42-9" id="__codelineno-42-9" name="__codelineno-42-9"></a><span class="kn">from</span> <span class="nn">peft</span> <span class="kn">import</span> <span class="n">LoraConfig</span>
<a href="#__codelineno-42-10" id="__codelineno-42-10" name="__codelineno-42-10"></a><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="p">(</span><span class="n">AutoModelForCausalLM</span><span class="p">,</span> <span class="n">AutoTokenizer</span><span class="p">,</span>
<a href="#__codelineno-42-11" id="__codelineno-42-11" name="__codelineno-42-11"></a>                        <span class="n">BitsAndBytesConfig</span><span class="p">)</span>
<a href="#__codelineno-42-12" id="__codelineno-42-12" name="__codelineno-42-12"></a>
<a href="#__codelineno-42-13" id="__codelineno-42-13" name="__codelineno-42-13"></a><span class="kn">from</span> <span class="nn">xtuner.dataset</span> <span class="kn">import</span> <span class="n">process_hf_dataset</span>
<a href="#__codelineno-42-14" id="__codelineno-42-14" name="__codelineno-42-14"></a><span class="kn">from</span> <span class="nn">xtuner.dataset.collate_fns</span> <span class="kn">import</span> <span class="n">default_collate_fn</span>
<a href="#__codelineno-42-15" id="__codelineno-42-15" name="__codelineno-42-15"></a><span class="kn">from</span> <span class="nn">xtuner.dataset.map_fns</span> <span class="kn">import</span> <span class="n">oasst1_map_fn</span><span class="p">,</span> <span class="n">template_map_fn_factory</span>
<a href="#__codelineno-42-16" id="__codelineno-42-16" name="__codelineno-42-16"></a><span class="kn">from</span> <span class="nn">xtuner.engine</span> <span class="kn">import</span> <span class="n">DatasetInfoHook</span><span class="p">,</span> <span class="n">EvaluateChatHook</span>
<a href="#__codelineno-42-17" id="__codelineno-42-17" name="__codelineno-42-17"></a><span class="kn">from</span> <span class="nn">xtuner.model</span> <span class="kn">import</span> <span class="n">SupervisedFinetune</span>
<a href="#__codelineno-42-18" id="__codelineno-42-18" name="__codelineno-42-18"></a><span class="kn">from</span> <span class="nn">xtuner.utils</span> <span class="kn">import</span> <span class="n">PROMPT_TEMPLATE</span>
<a href="#__codelineno-42-19" id="__codelineno-42-19" name="__codelineno-42-19"></a>
<a href="#__codelineno-42-20" id="__codelineno-42-20" name="__codelineno-42-20"></a><span class="c1">#######################################################################</span>
<a href="#__codelineno-42-21" id="__codelineno-42-21" name="__codelineno-42-21"></a><span class="c1">#                          PART 1  Settings                           #</span>
<a href="#__codelineno-42-22" id="__codelineno-42-22" name="__codelineno-42-22"></a><span class="c1">#######################################################################</span>
<a href="#__codelineno-42-23" id="__codelineno-42-23" name="__codelineno-42-23"></a><span class="c1"># Model</span>
<a href="#__codelineno-42-24" id="__codelineno-42-24" name="__codelineno-42-24"></a><span class="n">pretrained_model_name_or_path</span> <span class="o">=</span> <span class="s1">'/root/personal_assistant/model/Shanghai_AI_Laboratory/internlm-chat-7b'</span>
<a href="#__codelineno-42-25" id="__codelineno-42-25" name="__codelineno-42-25"></a>
<a href="#__codelineno-42-26" id="__codelineno-42-26" name="__codelineno-42-26"></a><span class="c1"># Data</span>
<a href="#__codelineno-42-27" id="__codelineno-42-27" name="__codelineno-42-27"></a><span class="n">data_path</span> <span class="o">=</span> <span class="s1">'/root/personal_assistant/data/personal_assistant.json'</span>
<a href="#__codelineno-42-28" id="__codelineno-42-28" name="__codelineno-42-28"></a><span class="n">prompt_template</span> <span class="o">=</span> <span class="n">PROMPT_TEMPLATE</span><span class="o">.</span><span class="n">internlm_chat</span>
<a href="#__codelineno-42-29" id="__codelineno-42-29" name="__codelineno-42-29"></a><span class="n">max_length</span> <span class="o">=</span> <span class="mi">512</span>
<a href="#__codelineno-42-30" id="__codelineno-42-30" name="__codelineno-42-30"></a><span class="n">pack_to_max_length</span> <span class="o">=</span> <span class="kc">True</span>
<a href="#__codelineno-42-31" id="__codelineno-42-31" name="__codelineno-42-31"></a>
<a href="#__codelineno-42-32" id="__codelineno-42-32" name="__codelineno-42-32"></a><span class="c1"># Scheduler &amp; Optimizer</span>
<a href="#__codelineno-42-33" id="__codelineno-42-33" name="__codelineno-42-33"></a><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">2</span>  <span class="c1"># per_device</span>
<a href="#__codelineno-42-34" id="__codelineno-42-34" name="__codelineno-42-34"></a><span class="n">accumulative_counts</span> <span class="o">=</span> <span class="mi">16</span>
<a href="#__codelineno-42-35" id="__codelineno-42-35" name="__codelineno-42-35"></a><span class="n">dataloader_num_workers</span> <span class="o">=</span> <span class="mi">0</span>
<a href="#__codelineno-42-36" id="__codelineno-42-36" name="__codelineno-42-36"></a><span class="n">max_epochs</span> <span class="o">=</span> <span class="mi">3</span>
<a href="#__codelineno-42-37" id="__codelineno-42-37" name="__codelineno-42-37"></a><span class="n">optim_type</span> <span class="o">=</span> <span class="n">PagedAdamW32bit</span>
<a href="#__codelineno-42-38" id="__codelineno-42-38" name="__codelineno-42-38"></a><span class="n">lr</span> <span class="o">=</span> <span class="mf">2e-4</span>
<a href="#__codelineno-42-39" id="__codelineno-42-39" name="__codelineno-42-39"></a><span class="n">betas</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">)</span>
<a href="#__codelineno-42-40" id="__codelineno-42-40" name="__codelineno-42-40"></a><span class="n">weight_decay</span> <span class="o">=</span> <span class="mi">0</span>
<a href="#__codelineno-42-41" id="__codelineno-42-41" name="__codelineno-42-41"></a><span class="n">max_norm</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># grad clip</span>
<a href="#__codelineno-42-42" id="__codelineno-42-42" name="__codelineno-42-42"></a>
<a href="#__codelineno-42-43" id="__codelineno-42-43" name="__codelineno-42-43"></a><span class="c1"># Evaluate the generation performance during the training</span>
<a href="#__codelineno-42-44" id="__codelineno-42-44" name="__codelineno-42-44"></a><span class="n">evaluation_freq</span> <span class="o">=</span> <span class="mi">90</span>
<a href="#__codelineno-42-45" id="__codelineno-42-45" name="__codelineno-42-45"></a><span class="n">SYSTEM</span> <span class="o">=</span> <span class="s1">''</span>
<a href="#__codelineno-42-46" id="__codelineno-42-46" name="__codelineno-42-46"></a><span class="n">evaluation_inputs</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">'请介绍一下你自己'</span><span class="p">,</span> <span class="s1">'请做一下自我介绍'</span> <span class="p">]</span>
<a href="#__codelineno-42-47" id="__codelineno-42-47" name="__codelineno-42-47"></a>
<a href="#__codelineno-42-48" id="__codelineno-42-48" name="__codelineno-42-48"></a><span class="c1">#######################################################################</span>
<a href="#__codelineno-42-49" id="__codelineno-42-49" name="__codelineno-42-49"></a><span class="c1">#                      PART 2  Model &amp; Tokenizer                      #</span>
<a href="#__codelineno-42-50" id="__codelineno-42-50" name="__codelineno-42-50"></a><span class="c1">#######################################################################</span>
<a href="#__codelineno-42-51" id="__codelineno-42-51" name="__codelineno-42-51"></a><span class="n">tokenizer</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-52" id="__codelineno-42-52" name="__codelineno-42-52"></a>    <span class="nb">type</span><span class="o">=</span><span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">,</span>
<a href="#__codelineno-42-53" id="__codelineno-42-53" name="__codelineno-42-53"></a>    <span class="n">pretrained_model_name_or_path</span><span class="o">=</span><span class="n">pretrained_model_name_or_path</span><span class="p">,</span>
<a href="#__codelineno-42-54" id="__codelineno-42-54" name="__codelineno-42-54"></a>    <span class="n">trust_remote_code</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a href="#__codelineno-42-55" id="__codelineno-42-55" name="__codelineno-42-55"></a>    <span class="n">padding_side</span><span class="o">=</span><span class="s1">'right'</span><span class="p">)</span>
<a href="#__codelineno-42-56" id="__codelineno-42-56" name="__codelineno-42-56"></a>
<a href="#__codelineno-42-57" id="__codelineno-42-57" name="__codelineno-42-57"></a><span class="n">model</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-58" id="__codelineno-42-58" name="__codelineno-42-58"></a>    <span class="nb">type</span><span class="o">=</span><span class="n">SupervisedFinetune</span><span class="p">,</span>
<a href="#__codelineno-42-59" id="__codelineno-42-59" name="__codelineno-42-59"></a>    <span class="n">llm</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-60" id="__codelineno-42-60" name="__codelineno-42-60"></a>        <span class="nb">type</span><span class="o">=</span><span class="n">AutoModelForCausalLM</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">,</span>
<a href="#__codelineno-42-61" id="__codelineno-42-61" name="__codelineno-42-61"></a>        <span class="n">pretrained_model_name_or_path</span><span class="o">=</span><span class="n">pretrained_model_name_or_path</span><span class="p">,</span>
<a href="#__codelineno-42-62" id="__codelineno-42-62" name="__codelineno-42-62"></a>        <span class="n">trust_remote_code</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a href="#__codelineno-42-63" id="__codelineno-42-63" name="__codelineno-42-63"></a>        <span class="n">torch_dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span>
<a href="#__codelineno-42-64" id="__codelineno-42-64" name="__codelineno-42-64"></a>        <span class="n">quantization_config</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-65" id="__codelineno-42-65" name="__codelineno-42-65"></a>            <span class="nb">type</span><span class="o">=</span><span class="n">BitsAndBytesConfig</span><span class="p">,</span>
<a href="#__codelineno-42-66" id="__codelineno-42-66" name="__codelineno-42-66"></a>            <span class="n">load_in_4bit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a href="#__codelineno-42-67" id="__codelineno-42-67" name="__codelineno-42-67"></a>            <span class="n">load_in_8bit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a href="#__codelineno-42-68" id="__codelineno-42-68" name="__codelineno-42-68"></a>            <span class="n">llm_int8_threshold</span><span class="o">=</span><span class="mf">6.0</span><span class="p">,</span>
<a href="#__codelineno-42-69" id="__codelineno-42-69" name="__codelineno-42-69"></a>            <span class="n">llm_int8_has_fp16_weight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a href="#__codelineno-42-70" id="__codelineno-42-70" name="__codelineno-42-70"></a>            <span class="n">bnb_4bit_compute_dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float16</span><span class="p">,</span>
<a href="#__codelineno-42-71" id="__codelineno-42-71" name="__codelineno-42-71"></a>            <span class="n">bnb_4bit_use_double_quant</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a href="#__codelineno-42-72" id="__codelineno-42-72" name="__codelineno-42-72"></a>            <span class="n">bnb_4bit_quant_type</span><span class="o">=</span><span class="s1">'nf4'</span><span class="p">)),</span>
<a href="#__codelineno-42-73" id="__codelineno-42-73" name="__codelineno-42-73"></a>    <span class="n">lora</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-74" id="__codelineno-42-74" name="__codelineno-42-74"></a>        <span class="nb">type</span><span class="o">=</span><span class="n">LoraConfig</span><span class="p">,</span>
<a href="#__codelineno-42-75" id="__codelineno-42-75" name="__codelineno-42-75"></a>        <span class="n">r</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
<a href="#__codelineno-42-76" id="__codelineno-42-76" name="__codelineno-42-76"></a>        <span class="n">lora_alpha</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
<a href="#__codelineno-42-77" id="__codelineno-42-77" name="__codelineno-42-77"></a>        <span class="n">lora_dropout</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<a href="#__codelineno-42-78" id="__codelineno-42-78" name="__codelineno-42-78"></a>        <span class="n">bias</span><span class="o">=</span><span class="s1">'none'</span><span class="p">,</span>
<a href="#__codelineno-42-79" id="__codelineno-42-79" name="__codelineno-42-79"></a>        <span class="n">task_type</span><span class="o">=</span><span class="s1">'CAUSAL_LM'</span><span class="p">))</span>
<a href="#__codelineno-42-80" id="__codelineno-42-80" name="__codelineno-42-80"></a>
<a href="#__codelineno-42-81" id="__codelineno-42-81" name="__codelineno-42-81"></a><span class="c1">#######################################################################</span>
<a href="#__codelineno-42-82" id="__codelineno-42-82" name="__codelineno-42-82"></a><span class="c1">#                      PART 3  Dataset &amp; Dataloader                   #</span>
<a href="#__codelineno-42-83" id="__codelineno-42-83" name="__codelineno-42-83"></a><span class="c1">#######################################################################</span>
<a href="#__codelineno-42-84" id="__codelineno-42-84" name="__codelineno-42-84"></a><span class="n">train_dataset</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-85" id="__codelineno-42-85" name="__codelineno-42-85"></a>    <span class="nb">type</span><span class="o">=</span><span class="n">process_hf_dataset</span><span class="p">,</span>
<a href="#__codelineno-42-86" id="__codelineno-42-86" name="__codelineno-42-86"></a>    <span class="n">dataset</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">load_dataset</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">'json'</span><span class="p">,</span> <span class="n">data_files</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">train</span><span class="o">=</span><span class="n">data_path</span><span class="p">)),</span>
<a href="#__codelineno-42-87" id="__codelineno-42-87" name="__codelineno-42-87"></a>    <span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span>
<a href="#__codelineno-42-88" id="__codelineno-42-88" name="__codelineno-42-88"></a>    <span class="n">max_length</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span>
<a href="#__codelineno-42-89" id="__codelineno-42-89" name="__codelineno-42-89"></a>    <span class="n">dataset_map_fn</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a href="#__codelineno-42-90" id="__codelineno-42-90" name="__codelineno-42-90"></a>    <span class="n">template_map_fn</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-91" id="__codelineno-42-91" name="__codelineno-42-91"></a>        <span class="nb">type</span><span class="o">=</span><span class="n">template_map_fn_factory</span><span class="p">,</span> <span class="n">template</span><span class="o">=</span><span class="n">prompt_template</span><span class="p">),</span>
<a href="#__codelineno-42-92" id="__codelineno-42-92" name="__codelineno-42-92"></a>    <span class="n">remove_unused_columns</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a href="#__codelineno-42-93" id="__codelineno-42-93" name="__codelineno-42-93"></a>    <span class="n">shuffle_before_pack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a href="#__codelineno-42-94" id="__codelineno-42-94" name="__codelineno-42-94"></a>    <span class="n">pack_to_max_length</span><span class="o">=</span><span class="n">pack_to_max_length</span><span class="p">)</span>
<a href="#__codelineno-42-95" id="__codelineno-42-95" name="__codelineno-42-95"></a>
<a href="#__codelineno-42-96" id="__codelineno-42-96" name="__codelineno-42-96"></a><span class="n">train_dataloader</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-97" id="__codelineno-42-97" name="__codelineno-42-97"></a>    <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span>
<a href="#__codelineno-42-98" id="__codelineno-42-98" name="__codelineno-42-98"></a>    <span class="n">num_workers</span><span class="o">=</span><span class="n">dataloader_num_workers</span><span class="p">,</span>
<a href="#__codelineno-42-99" id="__codelineno-42-99" name="__codelineno-42-99"></a>    <span class="n">dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span>
<a href="#__codelineno-42-100" id="__codelineno-42-100" name="__codelineno-42-100"></a>    <span class="n">sampler</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">DefaultSampler</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a href="#__codelineno-42-101" id="__codelineno-42-101" name="__codelineno-42-101"></a>    <span class="n">collate_fn</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">default_collate_fn</span><span class="p">))</span>
<a href="#__codelineno-42-102" id="__codelineno-42-102" name="__codelineno-42-102"></a>
<a href="#__codelineno-42-103" id="__codelineno-42-103" name="__codelineno-42-103"></a><span class="c1">#######################################################################</span>
<a href="#__codelineno-42-104" id="__codelineno-42-104" name="__codelineno-42-104"></a><span class="c1">#                    PART 4  Scheduler &amp; Optimizer                    #</span>
<a href="#__codelineno-42-105" id="__codelineno-42-105" name="__codelineno-42-105"></a><span class="c1">#######################################################################</span>
<a href="#__codelineno-42-106" id="__codelineno-42-106" name="__codelineno-42-106"></a><span class="c1"># optimizer</span>
<a href="#__codelineno-42-107" id="__codelineno-42-107" name="__codelineno-42-107"></a><span class="n">optim_wrapper</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-108" id="__codelineno-42-108" name="__codelineno-42-108"></a>    <span class="nb">type</span><span class="o">=</span><span class="n">AmpOptimWrapper</span><span class="p">,</span>
<a href="#__codelineno-42-109" id="__codelineno-42-109" name="__codelineno-42-109"></a>    <span class="n">optimizer</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-110" id="__codelineno-42-110" name="__codelineno-42-110"></a>        <span class="nb">type</span><span class="o">=</span><span class="n">optim_type</span><span class="p">,</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">,</span> <span class="n">betas</span><span class="o">=</span><span class="n">betas</span><span class="p">,</span> <span class="n">weight_decay</span><span class="o">=</span><span class="n">weight_decay</span><span class="p">),</span>
<a href="#__codelineno-42-111" id="__codelineno-42-111" name="__codelineno-42-111"></a>    <span class="n">clip_grad</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">max_norm</span><span class="o">=</span><span class="n">max_norm</span><span class="p">,</span> <span class="n">error_if_nonfinite</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a href="#__codelineno-42-112" id="__codelineno-42-112" name="__codelineno-42-112"></a>    <span class="n">accumulative_counts</span><span class="o">=</span><span class="n">accumulative_counts</span><span class="p">,</span>
<a href="#__codelineno-42-113" id="__codelineno-42-113" name="__codelineno-42-113"></a>    <span class="n">loss_scale</span><span class="o">=</span><span class="s1">'dynamic'</span><span class="p">,</span>
<a href="#__codelineno-42-114" id="__codelineno-42-114" name="__codelineno-42-114"></a>    <span class="n">dtype</span><span class="o">=</span><span class="s1">'float16'</span><span class="p">)</span>
<a href="#__codelineno-42-115" id="__codelineno-42-115" name="__codelineno-42-115"></a>
<a href="#__codelineno-42-116" id="__codelineno-42-116" name="__codelineno-42-116"></a><span class="c1"># learning policy</span>
<a href="#__codelineno-42-117" id="__codelineno-42-117" name="__codelineno-42-117"></a><span class="c1"># More information: https://github.com/open-mmlab/mmengine/blob/main/docs/en/tutorials/param_scheduler.md  # noqa: E501</span>
<a href="#__codelineno-42-118" id="__codelineno-42-118" name="__codelineno-42-118"></a><span class="n">param_scheduler</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-119" id="__codelineno-42-119" name="__codelineno-42-119"></a>    <span class="nb">type</span><span class="o">=</span><span class="n">CosineAnnealingLR</span><span class="p">,</span>
<a href="#__codelineno-42-120" id="__codelineno-42-120" name="__codelineno-42-120"></a>    <span class="n">eta_min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a href="#__codelineno-42-121" id="__codelineno-42-121" name="__codelineno-42-121"></a>    <span class="n">by_epoch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a href="#__codelineno-42-122" id="__codelineno-42-122" name="__codelineno-42-122"></a>    <span class="n">T_max</span><span class="o">=</span><span class="n">max_epochs</span><span class="p">,</span>
<a href="#__codelineno-42-123" id="__codelineno-42-123" name="__codelineno-42-123"></a>    <span class="n">convert_to_iter_based</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a href="#__codelineno-42-124" id="__codelineno-42-124" name="__codelineno-42-124"></a>
<a href="#__codelineno-42-125" id="__codelineno-42-125" name="__codelineno-42-125"></a><span class="c1"># train, val, test setting</span>
<a href="#__codelineno-42-126" id="__codelineno-42-126" name="__codelineno-42-126"></a><span class="n">train_cfg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">by_epoch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_epochs</span><span class="o">=</span><span class="n">max_epochs</span><span class="p">,</span> <span class="n">val_interval</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a href="#__codelineno-42-127" id="__codelineno-42-127" name="__codelineno-42-127"></a>
<a href="#__codelineno-42-128" id="__codelineno-42-128" name="__codelineno-42-128"></a><span class="c1">#######################################################################</span>
<a href="#__codelineno-42-129" id="__codelineno-42-129" name="__codelineno-42-129"></a><span class="c1">#                           PART 5  Runtime                           #</span>
<a href="#__codelineno-42-130" id="__codelineno-42-130" name="__codelineno-42-130"></a><span class="c1">#######################################################################</span>
<a href="#__codelineno-42-131" id="__codelineno-42-131" name="__codelineno-42-131"></a><span class="c1"># Log the dialogue periodically during the training process, optional</span>
<a href="#__codelineno-42-132" id="__codelineno-42-132" name="__codelineno-42-132"></a><span class="n">custom_hooks</span> <span class="o">=</span> <span class="p">[</span>
<a href="#__codelineno-42-133" id="__codelineno-42-133" name="__codelineno-42-133"></a>    <span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">DatasetInfoHook</span><span class="p">,</span> <span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">),</span>
<a href="#__codelineno-42-134" id="__codelineno-42-134" name="__codelineno-42-134"></a>    <span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-135" id="__codelineno-42-135" name="__codelineno-42-135"></a>        <span class="nb">type</span><span class="o">=</span><span class="n">EvaluateChatHook</span><span class="p">,</span>
<a href="#__codelineno-42-136" id="__codelineno-42-136" name="__codelineno-42-136"></a>        <span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span>
<a href="#__codelineno-42-137" id="__codelineno-42-137" name="__codelineno-42-137"></a>        <span class="n">every_n_iters</span><span class="o">=</span><span class="n">evaluation_freq</span><span class="p">,</span>
<a href="#__codelineno-42-138" id="__codelineno-42-138" name="__codelineno-42-138"></a>        <span class="n">evaluation_inputs</span><span class="o">=</span><span class="n">evaluation_inputs</span><span class="p">,</span>
<a href="#__codelineno-42-139" id="__codelineno-42-139" name="__codelineno-42-139"></a>        <span class="n">system</span><span class="o">=</span><span class="n">SYSTEM</span><span class="p">,</span>
<a href="#__codelineno-42-140" id="__codelineno-42-140" name="__codelineno-42-140"></a>        <span class="n">prompt_template</span><span class="o">=</span><span class="n">prompt_template</span><span class="p">)</span>
<a href="#__codelineno-42-141" id="__codelineno-42-141" name="__codelineno-42-141"></a><span class="p">]</span>
<a href="#__codelineno-42-142" id="__codelineno-42-142" name="__codelineno-42-142"></a>
<a href="#__codelineno-42-143" id="__codelineno-42-143" name="__codelineno-42-143"></a><span class="c1"># configure default hooks</span>
<a href="#__codelineno-42-144" id="__codelineno-42-144" name="__codelineno-42-144"></a><span class="n">default_hooks</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-145" id="__codelineno-42-145" name="__codelineno-42-145"></a>    <span class="c1"># record the time of every iteration.</span>
<a href="#__codelineno-42-146" id="__codelineno-42-146" name="__codelineno-42-146"></a>    <span class="n">timer</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">IterTimerHook</span><span class="p">),</span>
<a href="#__codelineno-42-147" id="__codelineno-42-147" name="__codelineno-42-147"></a>    <span class="c1"># print log every 100 iterations.</span>
<a href="#__codelineno-42-148" id="__codelineno-42-148" name="__codelineno-42-148"></a>    <span class="n">logger</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">LoggerHook</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
<a href="#__codelineno-42-149" id="__codelineno-42-149" name="__codelineno-42-149"></a>    <span class="c1"># enable the parameter scheduler.</span>
<a href="#__codelineno-42-150" id="__codelineno-42-150" name="__codelineno-42-150"></a>    <span class="n">param_scheduler</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">ParamSchedulerHook</span><span class="p">),</span>
<a href="#__codelineno-42-151" id="__codelineno-42-151" name="__codelineno-42-151"></a>    <span class="c1"># save checkpoint per epoch.</span>
<a href="#__codelineno-42-152" id="__codelineno-42-152" name="__codelineno-42-152"></a>    <span class="n">checkpoint</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">CheckpointHook</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<a href="#__codelineno-42-153" id="__codelineno-42-153" name="__codelineno-42-153"></a>    <span class="c1"># set sampler seed in distributed evrionment.</span>
<a href="#__codelineno-42-154" id="__codelineno-42-154" name="__codelineno-42-154"></a>    <span class="n">sampler_seed</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="n">DistSamplerSeedHook</span><span class="p">),</span>
<a href="#__codelineno-42-155" id="__codelineno-42-155" name="__codelineno-42-155"></a><span class="p">)</span>
<a href="#__codelineno-42-156" id="__codelineno-42-156" name="__codelineno-42-156"></a>
<a href="#__codelineno-42-157" id="__codelineno-42-157" name="__codelineno-42-157"></a><span class="c1"># configure environment</span>
<a href="#__codelineno-42-158" id="__codelineno-42-158" name="__codelineno-42-158"></a><span class="n">env_cfg</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
<a href="#__codelineno-42-159" id="__codelineno-42-159" name="__codelineno-42-159"></a>    <span class="c1"># whether to enable cudnn benchmark</span>
<a href="#__codelineno-42-160" id="__codelineno-42-160" name="__codelineno-42-160"></a>    <span class="n">cudnn_benchmark</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a href="#__codelineno-42-161" id="__codelineno-42-161" name="__codelineno-42-161"></a>    <span class="c1"># set multi process parameters</span>
<a href="#__codelineno-42-162" id="__codelineno-42-162" name="__codelineno-42-162"></a>    <span class="n">mp_cfg</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">mp_start_method</span><span class="o">=</span><span class="s1">'fork'</span><span class="p">,</span> <span class="n">opencv_num_threads</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
<a href="#__codelineno-42-163" id="__codelineno-42-163" name="__codelineno-42-163"></a>    <span class="c1"># set distributed parameters</span>
<a href="#__codelineno-42-164" id="__codelineno-42-164" name="__codelineno-42-164"></a>    <span class="n">dist_cfg</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">backend</span><span class="o">=</span><span class="s1">'nccl'</span><span class="p">),</span>
<a href="#__codelineno-42-165" id="__codelineno-42-165" name="__codelineno-42-165"></a><span class="p">)</span>
<a href="#__codelineno-42-166" id="__codelineno-42-166" name="__codelineno-42-166"></a>
<a href="#__codelineno-42-167" id="__codelineno-42-167" name="__codelineno-42-167"></a><span class="c1"># set visualizer</span>
<a href="#__codelineno-42-168" id="__codelineno-42-168" name="__codelineno-42-168"></a><span class="n">visualizer</span> <span class="o">=</span> <span class="kc">None</span>
<a href="#__codelineno-42-169" id="__codelineno-42-169" name="__codelineno-42-169"></a>
<a href="#__codelineno-42-170" id="__codelineno-42-170" name="__codelineno-42-170"></a><span class="c1"># set log level</span>
<a href="#__codelineno-42-171" id="__codelineno-42-171" name="__codelineno-42-171"></a><span class="n">log_level</span> <span class="o">=</span> <span class="s1">'INFO'</span>
<a href="#__codelineno-42-172" id="__codelineno-42-172" name="__codelineno-42-172"></a>
<a href="#__codelineno-42-173" id="__codelineno-42-173" name="__codelineno-42-173"></a><span class="c1"># load from which checkpoint</span>
<a href="#__codelineno-42-174" id="__codelineno-42-174" name="__codelineno-42-174"></a><span class="n">load_from</span> <span class="o">=</span> <span class="kc">None</span>
<a href="#__codelineno-42-175" id="__codelineno-42-175" name="__codelineno-42-175"></a>
<a href="#__codelineno-42-176" id="__codelineno-42-176" name="__codelineno-42-176"></a><span class="c1"># whether to resume training from the loaded checkpoint</span>
<a href="#__codelineno-42-177" id="__codelineno-42-177" name="__codelineno-42-177"></a><span class="n">resume</span> <span class="o">=</span> <span class="kc">False</span>
<a href="#__codelineno-42-178" id="__codelineno-42-178" name="__codelineno-42-178"></a>
<a href="#__codelineno-42-179" id="__codelineno-42-179" name="__codelineno-42-179"></a><span class="c1"># Defaults to use random seed and disable `deterministic`</span>
<a href="#__codelineno-42-180" id="__codelineno-42-180" name="__codelineno-42-180"></a><span class="n">randomness</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">deterministic</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
</details>
<h3 id="_35">微调<a class="headerlink" href="#_35" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-43-1" id="__codelineno-43-1" name="__codelineno-43-1"></a>xtuner<span class="w"> </span>train<span class="w"> </span>/root/personal_assistant/config/internlm_chat_7b_qlora_oasst1_e3_copy.py
</code></pre></div>
<h3 id="_36">参数转换<span class="heti-skip"><span class="heti-spacing"> </span>/<span class="heti-spacing"> </span></span>合并<a class="headerlink" href="#_36" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li>训练后的<span class="heti-skip"><span class="heti-spacing"> </span>pth<span class="heti-spacing"> </span></span>格式参数转<span class="heti-skip"><span class="heti-spacing"> </span>Hugging Face<span class="heti-spacing"> </span></span>格式</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-44-1" id="__codelineno-44-1" name="__codelineno-44-1"></a><span class="c1"># 创建用于存放Hugging Face格式参数的hf文件夹</span>
<a href="#__codelineno-44-2" id="__codelineno-44-2" name="__codelineno-44-2"></a>mkdir<span class="w"> </span>/root/personal_assistant/config/work_dirs/hf
<a href="#__codelineno-44-3" id="__codelineno-44-3" name="__codelineno-44-3"></a>
<a href="#__codelineno-44-4" id="__codelineno-44-4" name="__codelineno-44-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MKL_SERVICE_FORCE_INTEL</span><span class="o">=</span><span class="m">1</span>
<a href="#__codelineno-44-5" id="__codelineno-44-5" name="__codelineno-44-5"></a>
<a href="#__codelineno-44-6" id="__codelineno-44-6" name="__codelineno-44-6"></a><span class="c1"># 配置文件存放的位置</span>
<a href="#__codelineno-44-7" id="__codelineno-44-7" name="__codelineno-44-7"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CONFIG_NAME_OR_PATH</span><span class="o">=</span>/root/personal_assistant/config/internlm_chat_7b_qlora_oasst1_e3_copy.py
<a href="#__codelineno-44-8" id="__codelineno-44-8" name="__codelineno-44-8"></a>
<a href="#__codelineno-44-9" id="__codelineno-44-9" name="__codelineno-44-9"></a><span class="c1"># 模型训练后得到的pth格式参数存放的位置</span>
<a href="#__codelineno-44-10" id="__codelineno-44-10" name="__codelineno-44-10"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PTH</span><span class="o">=</span>/root/personal_assistant/config/work_dirs/internlm_chat_7b_qlora_oasst1_e3_copy/epoch_3.pth
<a href="#__codelineno-44-11" id="__codelineno-44-11" name="__codelineno-44-11"></a>
<a href="#__codelineno-44-12" id="__codelineno-44-12" name="__codelineno-44-12"></a><span class="c1"># pth文件转换为Hugging Face格式后参数存放的位置</span>
<a href="#__codelineno-44-13" id="__codelineno-44-13" name="__codelineno-44-13"></a><span class="nb">export</span><span class="w"> </span><span class="nv">SAVE_PATH</span><span class="o">=</span>/root/personal_assistant/config/work_dirs/hf
<a href="#__codelineno-44-14" id="__codelineno-44-14" name="__codelineno-44-14"></a>
<a href="#__codelineno-44-15" id="__codelineno-44-15" name="__codelineno-44-15"></a><span class="c1"># 执行参数转换</span>
<a href="#__codelineno-44-16" id="__codelineno-44-16" name="__codelineno-44-16"></a>xtuner<span class="w"> </span>convert<span class="w"> </span>pth_to_hf<span class="w"> </span><span class="nv">$CONFIG_NAME_OR_PATH</span><span class="w"> </span><span class="nv">$PTH</span><span class="w"> </span><span class="nv">$SAVE_PATH</span>
</code></pre></div>
<ul>
<li><span>Merge<span class="heti-spacing"> </span></span>模型参数</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-45-1" id="__codelineno-45-1" name="__codelineno-45-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MKL_SERVICE_FORCE_INTEL</span><span class="o">=</span><span class="m">1</span>
<a href="#__codelineno-45-2" id="__codelineno-45-2" name="__codelineno-45-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">MKL_THREADING_LAYER</span><span class="o">=</span><span class="s1">'GNU'</span>
<a href="#__codelineno-45-3" id="__codelineno-45-3" name="__codelineno-45-3"></a>
<a href="#__codelineno-45-4" id="__codelineno-45-4" name="__codelineno-45-4"></a><span class="c1"># 原始模型参数存放的位置</span>
<a href="#__codelineno-45-5" id="__codelineno-45-5" name="__codelineno-45-5"></a><span class="nb">export</span><span class="w"> </span><span class="nv">NAME_OR_PATH_TO_LLM</span><span class="o">=</span>/root/personal_assistant/model/Shanghai_AI_Laboratory/internlm-chat-7b
<a href="#__codelineno-45-6" id="__codelineno-45-6" name="__codelineno-45-6"></a>
<a href="#__codelineno-45-7" id="__codelineno-45-7" name="__codelineno-45-7"></a><span class="c1"># Hugging Face格式参数存放的位置</span>
<a href="#__codelineno-45-8" id="__codelineno-45-8" name="__codelineno-45-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">NAME_OR_PATH_TO_ADAPTER</span><span class="o">=</span>/root/personal_assistant/config/work_dirs/hf
<a href="#__codelineno-45-9" id="__codelineno-45-9" name="__codelineno-45-9"></a>
<a href="#__codelineno-45-10" id="__codelineno-45-10" name="__codelineno-45-10"></a><span class="c1"># 最终Merge后的参数存放的位置</span>
<a href="#__codelineno-45-11" id="__codelineno-45-11" name="__codelineno-45-11"></a>mkdir<span class="w"> </span>/root/personal_assistant/config/work_dirs/hf_merge
<a href="#__codelineno-45-12" id="__codelineno-45-12" name="__codelineno-45-12"></a><span class="nb">export</span><span class="w"> </span><span class="nv">SAVE_PATH</span><span class="o">=</span>/root/personal_assistant/config/work_dirs/hf_merge
<a href="#__codelineno-45-13" id="__codelineno-45-13" name="__codelineno-45-13"></a>
<a href="#__codelineno-45-14" id="__codelineno-45-14" name="__codelineno-45-14"></a><span class="c1"># 执行参数Merge</span>
<a href="#__codelineno-45-15" id="__codelineno-45-15" name="__codelineno-45-15"></a>xtuner<span class="w"> </span>convert<span class="w"> </span>merge<span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-45-16" id="__codelineno-45-16" name="__codelineno-45-16"></a><span class="w">    </span><span class="nv">$NAME_OR_PATH_TO_LLM</span><span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-45-17" id="__codelineno-45-17" name="__codelineno-45-17"></a><span class="w">    </span><span class="nv">$NAME_OR_PATH_TO_ADAPTER</span><span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-45-18" id="__codelineno-45-18" name="__codelineno-45-18"></a><span class="w">    </span><span class="nv">$SAVE_PATH</span><span class="w"> </span><span class="se">\</span>
<a href="#__codelineno-45-19" id="__codelineno-45-19" name="__codelineno-45-19"></a><span class="w">    </span>--max-shard-size<span class="w"> </span>2GB
</code></pre></div>
<h3 id="demo">Demo<a class="headerlink" href="#demo" title="Permanent link">¶</a></h3>
<ul>
<li>安装依赖</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-46-1" id="__codelineno-46-1" name="__codelineno-46-1"></a>pip<span class="w"> </span>install<span class="w"> </span><span class="nv">streamlit</span><span class="o">==</span><span class="m">1</span>.24.0
</code></pre></div>
<ul>
<li>下载<span class="heti-skip"><span class="heti-spacing"> </span>InternLM<span class="heti-spacing"> </span></span>项目代码</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-47-1" id="__codelineno-47-1" name="__codelineno-47-1"></a><span class="c1"># 创建code文件夹用于存放InternLM项目代码</span>
<a href="#__codelineno-47-2" id="__codelineno-47-2" name="__codelineno-47-2"></a>mkdir<span class="w"> </span>/root/personal_assistant/code<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/root/personal_assistant/code
<a href="#__codelineno-47-3" id="__codelineno-47-3" name="__codelineno-47-3"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/InternLM/InternLM.git
</code></pre></div>
<ul>
<li>
<p>将 <code>/root/code/InternLM/web_demo.py</code> 中<span class="heti-skip"><span class="heti-spacing"> </span>29<span class="heti-spacing"> </span></span>行 和<span class="heti-skip"><span class="heti-spacing"> </span>33<span class="heti-spacing"> </span></span>行的模型路径更换为<span class="heti-skip"><span class="heti-spacing"> </span>Merge<span class="heti-spacing"> </span></span>后存放参数的路径 <code>/root/personal_assistant/config/work_dirs/hf_merge</code></p>
</li>
<li>
<p>运行 <code>/root/personal_assistant/code/InternLM</code> 目录下的 <code>web_demo.py</code> 文件，将端口映射到本地</p>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-48-1" id="__codelineno-48-1" name="__codelineno-48-1"></a>streamlit<span class="w"> </span>run<span class="w"> </span>/root/personal_assistant/code/InternLM/web_demo.py<span class="w"> </span>--server.address<span class="w"> </span><span class="m">127</span>.0.0.1<span class="w"> </span>--server.port<span class="w"> </span><span class="m">6006</span>
</code></pre></div>
<h3 id="_37">效果<a class="headerlink" href="#_37" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h3>
<ul>
<li><strong>微调前</strong>（回答比较官方）</li>
</ul>
<p></p><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/hw_4_1.jpg"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/hw_4_1.jpg"/></a></center>
<ul>
<li><strong>微调后</strong>（对自己的身份有了清晰的认知）</li>
</ul>
<p></p><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/hw_4_2.jpg"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/hw_4_2.jpg"/></a></center>
<h2 id="_38">进阶作业<a class="headerlink" href="#_38" title="Permanent link"><span><span class="heti-spacing"> </span>¶</span></a></h2>
<ul>
<li>
<p>将训练好的<span class="heti-skip"><span class="heti-spacing"> </span>Adapter<span class="heti-spacing"> </span></span>模型权重上传到<span><span class="heti-spacing"> </span>OpenXLab</span>、<span>Hugging Face<span class="heti-spacing"> </span></span>或者<span class="heti-skip"><span class="heti-spacing"> </span>MoelScope<span class="heti-spacing"> </span></span>任一一平台。</p>
<ol>
<li>通过<span class="heti-skip"><span class="heti-spacing"> </span>scp<span class="heti-spacing"> </span></span>将<span class="heti-skip"><span class="heti-spacing"> </span>hf<span class="heti-spacing"> </span></span>文件夹下载到本地，进入<span class="heti-skip"><span class="heti-spacing"> </span>HuggingFace<span class="heti-spacing"> </span></span>新建<span><span class="heti-spacing"> </span>model</span>，上传模型文件。<span>Adapter<span class="heti-spacing"> </span></span>权重地址：<a href="https://huggingface.co/jujimeizuo/assistant-jujimeizuo/tree/main">https://huggingface.co/jujimeizuo/assistant-jujimeizuo/tree/main</a></li>
</ol>
<p></p><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/hw_4_3.jpg"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/hw_4_3.jpg"/></a></center>
</li>
<li>
<p>将训练好后的模型应用部署到<span class="heti-skip"><span class="heti-spacing"> </span>OpenXLab<span class="heti-spacing"> </span></span>平台，参考部署文档请访问：<a href="https://aicarrier.feishu.cn/docx/MQH6dygcKolG37x0ekcc4oZhnCe">https://aicarrier.feishu.cn/docx/MQH6dygcKolG37x0ekcc4oZhnCe</a></p>
<ol>
<li>通过<span class="heti-skip"><span class="heti-spacing"> </span>openxlab<span class="heti-spacing"> </span></span>库上传模型文件</li>
</ol>
<p></p><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/hw_4_4.jpg"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/hw_4_4.jpg"/></a></center>
<ol start="2">
<li>
<p>新建<span class="heti-skip"><span class="heti-spacing"> </span>github<span class="heti-spacing"> </span></span>的<span><span class="heti-spacing"> </span>repo(</span><a href="https://github.com/jujimeizuo/assistant_jujimeizuo"><span><span class="heti-spacing"> </span>assistant_jujimeizuo</span></a><span><span class="heti-spacing"> </span>)</span>，从<span class="heti-skip"><span class="heti-spacing"> </span>OpenXLab<span class="heti-spacing"> </span></span>上拉取上传的模型，构建<span class="heti-skip"><span class="heti-spacing"> </span>streamlit<span class="heti-spacing"> </span></span>的<span><span class="heti-spacing"> </span>app</span>，同步到<span class="heti-skip"><span class="heti-spacing"> </span>OpenXLab<span class="heti-spacing"> </span></span>上。</p>
</li>
<li>
<p>应用服务地址：<a href="https://openxlab.org.cn/apps/detail/jujimeizuo/assistant_jujimeizuo">https://openxlab.org.cn/apps/detail/jujimeizuo/assistant_jujimeizuo</a></p>
</li>
</ol>
<p></p><center><a class="glightbox" data-desc-position="bottom" data-height="auto" data-width="80%" href="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/hw_4_5.jpg"><img src="https://cdn.jsdelivr.net/gh/jujimeizuo/note@gh-pages/assets/images/llm/internlm/hw_4_5.jpg"/></a></center>
</li>
</ul>
<hr/>
<div class="md-source-file">
<small>
    
      最后更新:
      <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2025年5月9日 15:51:31</span>
<br/>
        创建日期:
        <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-datetime">2024年1月11日 16:19:56</span>
</small>
</div>
<script async="" crossorigin="anonymous" data-category="General" data-category-id="DIC_kwDOKLqQvc4CY4-G" data-emit-metadata="0" data-input-position="bottom" data-lang="zh-CN" data-mapping="pathname" data-reactions-enabled="1" data-repo="jujimeizuo/note" data-repo-id="R_kgDOKLqQvQ" data-theme="light" src="https://giscus.app/client.js">
</script>
<script>
                      if (document.querySelector("body").getAttribute("data-md-color-scheme") === "slate") {
                        var giscus = document.querySelector("script[src*=giscus]")
                        giscus.setAttribute("data-theme", "https://gcore.jsdelivr.net/gh/jujimeizuo/note/docs/css/giscus.css") 
                      }
                    </script>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" data-md-state="hidden" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg>
              回到页面顶部
            </a>
</main>
<footer class="md-footer">
<nav aria-label="页脚" class="md-footer__inner md-grid">
<a aria-label="上一页: 第三节" class="md-footer__link md-footer__link--prev" href="../lec3/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                上一页
              </span>
              第三节
            </div>
</div>
</a>
<a aria-label="下一页: 第五节" class="md-footer__link md-footer__link--next" href="../lec5/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                下一页
              </span>
              第五节
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright © 2023-2025 <a href="https://github.com/jujimeizuo" rel="noopener" target="_blank">jujimeizuo</a>
</div>
  
  
    Powered by
    <a href="https://www.mkdocs.org/" rel="noopener" target="_blank">
      MkDocs
    </a>
    with theme
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material
    </a>
    modified by
    <a href="https://github.com/TonyCrane" rel="noopener" target="_blank">
      TonyCrane
    </a>
</div>
<div class="md-social">
<a class="md-social__link" href="https://github.com/jujimeizuo/" rel="noopener" target="_blank" title="github.com">
<svg viewbox="0 0 496 512" xmlns="http://www.w3.org/2000/svg"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
</a>
<a class="md-social__link" href="https://blog.jujimeizuo.cn/" rel="noopener" target="_blank" title="blog.jujimeizuo.cn">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M128.081 415.959c0 35.369-28.672 64.041-64.041 64.041S0 451.328 0 415.959s28.672-64.041 64.041-64.041 64.04 28.673 64.04 64.041zm175.66 47.25c-8.354-154.6-132.185-278.587-286.95-286.95C7.656 175.765 0 183.105 0 192.253v48.069c0 8.415 6.49 15.472 14.887 16.018 111.832 7.284 201.473 96.702 208.772 208.772.547 8.397 7.604 14.887 16.018 14.887h48.069c9.149.001 16.489-7.655 15.995-16.79zm144.249.288C439.596 229.677 251.465 40.445 16.503 32.01 7.473 31.686 0 38.981 0 48.016v48.068c0 8.625 6.835 15.645 15.453 15.999 191.179 7.839 344.627 161.316 352.465 352.465.353 8.618 7.373 15.453 15.999 15.453h48.068c9.034-.001 16.329-7.474 16.005-16.504z"></path></svg>
</a>
<a class="md-social__link" href="https://jujimeizuo.cn/" rel="noopener" target="_blank" title="jujimeizuo.cn">
<svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><path d="M280.37 148.26 96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47 488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "navigation.tracking", "navigation.tabs", "navigation.indexes", "navigation.top"], "search": "../../../assets/javascripts/workers/search.361d90f1.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.config.lang": "ja", "search.config.pipeline": "trimmer, stemmer", "search.config.separator": "[\\uff0c\\u3002]+", "search.placeholder": "\u641c\u7d22", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version.title": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
<script src="../../../assets/javascripts/bundle.289a2a4b.min.js"></script>
<script src="https://cdn.jujimeizuo.cn/utils/katex.min.js"></script>
<script src="../../../js/katex.js"></script>
<script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>
